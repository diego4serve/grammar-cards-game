import{a as I,f as N,d as Xn,c as Gn}from"../chunks/BIg0sYn1.js";import{o as Kn}from"../chunks/CJFNuX6i.js";import{h as ee,x as zt,W as Yn,e as Wt,o as Qn,n as Zn,B as u,t as er,v as tr,w as ks,y as $t,i as ut,a2 as sr,aO as nr,az as xs,c as Ce,f as ns,aV as rr,s as ar,aW as tn,R as ir,aX as or,aM as fs,aY as cr,am as Ts,aZ as lr,a_ as ur,aR as dr,a$ as de,r as sn,p as nn,b0 as Ft,q as hr,b1 as fr,b2 as pr,aL as mr,d as gr,a3 as vr,b3 as br,aS as _r,k as yr,al as wr,b4 as Sr,ai as fe,a8 as y,a9 as v,D as T,ab as g,a5 as he,a6 as $,aj as pe,aT as U,aU as ae,C as ps,a4 as rs}from"../chunks/xRZkEjnd.js";import{i as G,p as kr}from"../chunks/BtEb-poF.js";import{d as me,s as j,e as xr}from"../chunks/CRTnJ9BO.js";import{r as Rs,s as Es}from"../chunks/Df0M1iNH.js";function Ne(s,e){return e}function Tr(s,e,t){for(var n=[],r=e.length,a,i=e.length,o=0;o<r;o++){let w=e[o];nn(w,()=>{if(a){if(a.pending.delete(w),a.done.add(w),a.pending.size===0){var k=s.outrogroups;as(fs(a.done)),k.delete(a),k.size===0&&(s.outrogroups=null)}}else i-=1},!1)}if(i===0){var c=n.length===0&&t!==null;if(c){var d=t,f=d.parentNode;mr(f),f.append(d),s.items.clear()}as(e,!c)}else a={pending:new Set(e),done:new Set},(s.outrogroups??=new Set).add(a)}function as(s,e=!0){for(var t=0;t<s.length;t++)gr(s[t],e)}var Ms;function we(s,e,t,n,r,a=null){var i=s,o=new Map,c=(e&tn)!==0;if(c){var d=s;i=ee?zt(Yn(d)):d.appendChild(Wt())}ee&&Qn();var f=null,w=ir(()=>{var m=t();return or(m)?m:m==null?[]:fs(m)}),k,p=!0;function E(){h.fallback=f,Rr(h,k,i,e,n),f!==null&&(k.length===0?(f.f&de)===0?sn(f):(f.f^=de,Ye(f,null,i)):nn(f,()=>{f=null}))}var S=Zn(()=>{k=u(w);var m=k.length;let b=!1;if(ee){var M=er(i)===tr;M!==(m===0)&&(i=ks(),zt(i),$t(!1),b=!0)}for(var A=new Set,x=Ce,B=ar(),P=0;P<m;P+=1){ee&&ut.nodeType===sr&&ut.data===nr&&(i=ut,b=!0,$t(!1));var L=k[P],q=n(L,P),C=p?null:o.get(q);C?(C.v&&xs(C.v,L),C.i&&xs(C.i,P),B&&x.unskip_effect(C.e)):(C=Er(o,p?i:Ms??=Wt(),L,q,P,r,e,t),p||(C.e.f|=de),o.set(q,C)),A.add(q)}if(m===0&&a&&!f&&(p?f=ns(()=>a(i)):(f=ns(()=>a(Ms??=Wt())),f.f|=de)),m>A.size&&rr(),ee&&m>0&&zt(ks()),!p)if(B){for(const[H,K]of o)A.has(H)||x.skip_effect(K.e);x.oncommit(E),x.ondiscard(()=>{})}else E();b&&$t(!0),u(w)}),h={effect:S,items:o,outrogroups:null,fallback:f};p=!1,ee&&(i=ut)}function qe(s){for(;s!==null&&(s.f&fr)===0;)s=s.next;return s}function Rr(s,e,t,n,r){var a=(n&pr)!==0,i=e.length,o=s.items,c=qe(s.effect.first),d,f=null,w,k=[],p=[],E,S,h,m;if(a)for(m=0;m<i;m+=1)E=e[m],S=r(E,m),h=o.get(S).e,(h.f&de)===0&&(h.nodes?.a?.measure(),(w??=new Set).add(h));for(m=0;m<i;m+=1){if(E=e[m],S=r(E,m),h=o.get(S).e,s.outrogroups!==null)for(const C of s.outrogroups)C.pending.delete(h),C.done.delete(h);if((h.f&de)!==0)if(h.f^=de,h===c)Ye(h,null,t);else{var b=f?f.next:c;h===s.effect.last&&(s.effect.last=h.prev),h.prev&&(h.prev.next=h.next),h.next&&(h.next.prev=h.prev),ve(s,f,h),ve(s,h,b),Ye(h,b,t),f=h,k=[],p=[],c=qe(f.next);continue}if((h.f&Ft)!==0&&(sn(h),a&&(h.nodes?.a?.unfix(),(w??=new Set).delete(h))),h!==c){if(d!==void 0&&d.has(h)){if(k.length<p.length){var M=p[0],A;f=M.prev;var x=k[0],B=k[k.length-1];for(A=0;A<k.length;A+=1)Ye(k[A],M,t);for(A=0;A<p.length;A+=1)d.delete(p[A]);ve(s,x.prev,B.next),ve(s,f,x),ve(s,B,M),c=M,f=B,m-=1,k=[],p=[]}else d.delete(h),Ye(h,c,t),ve(s,h.prev,h.next),ve(s,h,f===null?s.effect.first:f.next),ve(s,f,h),f=h;continue}for(k=[],p=[];c!==null&&c!==h;)(d??=new Set).add(c),p.push(c),c=qe(c.next);if(c===null)continue}(h.f&de)===0&&k.push(h),f=h,c=qe(h.next)}if(s.outrogroups!==null){for(const C of s.outrogroups)C.pending.size===0&&(as(fs(C.done)),s.outrogroups?.delete(C));s.outrogroups.size===0&&(s.outrogroups=null)}if(c!==null||d!==void 0){var P=[];if(d!==void 0)for(h of d)(h.f&Ft)===0&&P.push(h);for(;c!==null;)(c.f&Ft)===0&&c!==s.fallback&&P.push(c),c=qe(c.next);var L=P.length;if(L>0){var q=(n&tn)!==0&&i===0?t:null;if(a){for(m=0;m<L;m+=1)P[m].nodes?.a?.measure();for(m=0;m<L;m+=1)P[m].nodes?.a?.fix()}Tr(s,P,q)}}a&&hr(()=>{if(w!==void 0)for(h of w)h.nodes?.a?.apply()})}function Er(s,e,t,n,r,a,i,o){var c=(i&lr)!==0?(i&ur)===0?dr(t,!1,!1):Ts(t):null,d=(i&cr)!==0?Ts(r):null;return{v:c,i:d,e:ns(()=>(a(e,c??t,d??r,o),()=>{s.delete(n)}))}}function Ye(s,e,t){if(s.nodes)for(var n=s.nodes.start,r=s.nodes.end,a=e&&(e.f&de)===0?e.nodes.start:t;n!==null;){var i=vr(n);if(a.before(n),n===r)return;n=i}}function ve(s,e,t){e===null?s.effect.first=t:e.next=t,t===null?s.effect.last=e:t.prev=e}const Ps=[...` 	
\r\fÂ \v\uFEFF`];function Mr(s,e,t){var n=s==null?"":""+s;if(e&&(n=n?n+" "+e:e),t){for(var r in t)if(t[r])n=n?n+" "+r:r;else if(n.length)for(var a=r.length,i=0;(i=n.indexOf(r,i))>=0;){var o=i+a;(i===0||Ps.includes(n[i-1]))&&(o===n.length||Ps.includes(n[o]))?n=(i===0?"":n.substring(0,i))+n.substring(o+1):i=o}}return n===""?null:n}function Pr(s,e){return s==null?null:String(s)}function et(s,e,t,n,r,a){var i=s.__className;if(ee||i!==t||i===void 0){var o=Mr(t,n,a);(!ee||o!==s.getAttribute("class"))&&(o==null?s.removeAttribute("class"):s.className=o),s.__className=t}else if(a&&r!==a)for(var c in a){var d=!!a[c];(r==null||d!==!!r[c])&&s.classList.toggle(c,d)}return a}function Ar(s,e,t,n){var r=s.__style;if(ee||r!==e){var a=Pr(e);(!ee||a!==s.getAttribute("style"))&&(a==null?s.removeAttribute("style"):s.style.cssText=a),s.__style=e}return n}function As(s,e,t=e){var n=new WeakSet;br(s,"input",async r=>{var a=r?s.defaultValue:s.value;if(a=Vt(s)?Ht(a):a,t(a),Ce!==null&&n.add(Ce),await _r(),a!==(a=e())){var i=s.selectionStart,o=s.selectionEnd,c=s.value.length;if(s.value=a??"",o!==null){var d=s.value.length;i===o&&o===c&&d>c?(s.selectionStart=d,s.selectionEnd=d):(s.selectionStart=i,s.selectionEnd=Math.min(o,d))}}}),(ee&&s.defaultValue!==s.value||yr(e)==null&&s.value)&&(t(Vt(s)?Ht(s.value):s.value),Ce!==null&&n.add(Ce)),wr(()=>{var r=e();if(s===document.activeElement){var a=Sr??Ce;if(n.has(a))return}Vt(s)&&r===Ht(s.value)||s.type==="date"&&!r&&!s.value||r!==s.value&&(s.value=r??"")})}function Vt(s){var e=s.type;return e==="number"||e==="range"}function Ht(s){return s===""?null:+s}var Cr=N('<input type="text" placeholder="sk-ant-..." class="api-input svelte-1s08ceg"/>'),Ir=N('<input type="password" placeholder="sk-ant-..." class="api-input svelte-1s08ceg"/>'),jr=N('<div class="setup svelte-1s08ceg"><p class="subtitle svelte-1s08ceg">Aprende gramatica inglesa armando frases con tarjetas</p> <div class="card svelte-1s08ceg"><p class="instructions svelte-1s08ceg">Ingresa tu API key de Anthropic para comenzar:</p> <form class="svelte-1s08ceg"><div class="input-wrapper svelte-1s08ceg"><!> <button type="button" class="toggle-btn svelte-1s08ceg"> </button></div> <button type="submit" class="submit-btn svelte-1s08ceg">Guardar y continuar</button></form> <p class="note svelte-1s08ceg">Tu key se guarda solo en este navegador (localStorage).</p></div> <p class="footer svelte-1s08ceg">Hecho con ðŸ§¡ por <a class="author-link svelte-1s08ceg" href="https://www.linkedin.com/in/diegofdom/" target="_blank" rel="noopener noreferrer">Diego Dominguez</a></p></div>');function Nr(s,e){fe(e,!0);let t=U(""),n=U(!1);function r(){const S=u(t).trim();S&&e.onsave(S)}var a=jr(),i=y(v(a),2),o=y(v(i),2),c=v(o),d=v(c);{var f=S=>{var h=Cr();Rs(h),As(h,()=>u(t),m=>T(t,m)),I(S,h)},w=S=>{var h=Ir();Rs(h),As(h,()=>u(t),m=>T(t,m)),I(S,h)};G(d,S=>{u(n)?S(f):S(w,!1)})}var k=y(d,2);k.__click=()=>T(n,!u(n));var p=v(k,!0);g(k),g(c);var E=y(c,2);g(o),he(2),g(i),he(2),g(a),$(S=>{j(p,u(n)?"Ocultar":"Mostrar"),E.disabled=S},[()=>!u(t).trim()]),xr("submit",o,r),I(s,a),pe()}me(["click"]);const rn=[{id:"random",label:"Aleatorio",description:"Temas variados en cada ejercicio"},{id:"daily routine",label:"Rutina diaria",description:"Actividades del dÃ­a a dÃ­a"},{id:"travel",label:"Viajes",description:"Aeropuertos, hoteles, destinos"},{id:"work",label:"Trabajo",description:"Oficina, tareas, compaÃ±eros"},{id:"food",label:"Comida",description:"Restaurantes, recetas, cocina"},{id:"sports",label:"Deportes",description:"Partidos, entrenamiento, equipos"},{id:"shopping",label:"Compras",description:"Tiendas, precios, productos"},{id:"family",label:"Familia",description:"Padres, hijos, reuniones"},{id:"health",label:"Salud",description:"Doctor, ejercicio, bienestar"},{id:"technology",label:"TecnologÃ­a",description:"Apps, gadgets, internet"},{id:"hobbies",label:"Hobbies",description:"MÃºsica, lectura, juegos"},{id:"weather",label:"Clima",description:"Sol, lluvia, estaciones"},{id:"school",label:"Escuela",description:"Clases, exÃ¡menes, campus"},{id:"nature",label:"Naturaleza",description:"Animales, plantas, paisajes"}],Or=[{id:"dev meetings & scrum",label:"Dev & Scrum",description:"Sprints, standups, PRs, deploys"},{id:"software engineering",label:"Software Dev",description:"CÃ³digo, arquitectura, cloud, APIs"}],qr=rn.filter(s=>s.id!=="random").map(s=>s.id);var Br=N("<button> </button>"),Lr=N("<button> </button>"),Dr=N('<button class="tense-badge svelte-ro4c24"> </button>'),Ur=N('<div class="level-card svelte-ro4c24" role="group"><button class="level-header svelte-ro4c24"><span class="level-label svelte-ro4c24"> </span> <span class="level-desc svelte-ro4c24"> </span></button> <div class="tense-badges svelte-ro4c24"></div></div>'),zr=N('<div class="selector svelte-ro4c24"><p class="intro svelte-ro4c24">Elige un tema y un nivel para empezar. Si quieres practicar un tiempo en particular, toca el badge.</p> <div class="topic-section svelte-ro4c24"><div class="topic-chips svelte-ro4c24"></div> <div class="specialized-section svelte-ro4c24"><div class="specialized-line svelte-ro4c24"><span class="specialized-label svelte-ro4c24">Especializados</span></div> <div class="topic-chips svelte-ro4c24"></div></div></div> <div class="levels svelte-ro4c24"></div> <button class="glossary-btn svelte-ro4c24"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg> Glosario gramatical</button> <button class="change-key-btn svelte-ro4c24">Cambiar API key</button> <p class="footer svelte-ro4c24">Hecho con <button class="heart-link svelte-ro4c24">ðŸ§¡</button> por <a class="author-link svelte-ro4c24" href="https://www.linkedin.com/in/diegofdom/" target="_blank" rel="noopener noreferrer">Diego Dominguez</a></p></div>');function Wr(s,e){fe(e,!0);let t=U("random");const n=[{key:"beginner",label:"Principiante",tenses:["Present simple","Present continuous","Going to","Simple past"],description:"Presente simple, presente continuo, futuro con going to, pasado simple."},{key:"intermediate",label:"Intermedio",tenses:["Present perfect","Past continuous","Will future","First conditional","Modals"],description:"Presente perfecto, pasado continuo, futuro con will, primer condicional, verbos modales."},{key:"advanced",label:"Avanzado",tenses:["Past perfect","Third conditional","Passive voice","Reported speech","Subjunctive"],description:"Pasado perfecto, tercer condicional, voz pasiva, estilo indirecto, subjuntivo."}];function r(S,h,m){S.stopPropagation(),e.onselect(h,u(t),m)}var a=zr(),i=y(v(a),2),o=v(i);we(o,21,()=>rn,Ne,(S,h)=>{var m=Br();let b;m.__click=()=>T(t,u(h).id,!0);var M=v(m,!0);g(m),$(()=>{b=et(m,1,"topic-chip svelte-ro4c24",null,b,{active:u(t)===u(h).id}),Es(m,"title",u(h).description),j(M,u(h).label)}),I(S,m)}),g(o);var c=y(o,2),d=y(v(c),2);we(d,21,()=>Or,Ne,(S,h)=>{var m=Lr();let b;m.__click=()=>T(t,u(h).id,!0);var M=v(m,!0);g(m),$(()=>{b=et(m,1,"topic-chip specialized svelte-ro4c24",null,b,{active:u(t)===u(h).id}),Es(m,"title",u(h).description),j(M,u(h).label)}),I(S,m)}),g(d),g(c),g(i);var f=y(i,2);we(f,21,()=>n,Ne,(S,h)=>{var m=Ur(),b=v(m);b.__click=()=>e.onselect(u(h).key,u(t));var M=v(b),A=v(M,!0);g(M);var x=y(M,2),B=v(x,!0);g(x),g(b);var P=y(b,2);we(P,21,()=>u(h).tenses,Ne,(L,q)=>{var C=Dr();C.__click=K=>r(K,u(h).key,u(q).toLowerCase());var H=v(C,!0);g(C),$(()=>j(H,u(q))),I(L,C)}),g(P),g(m),$(()=>{j(A,u(h).label),j(B,u(h).description)}),I(S,m)}),g(f);var w=y(f,2);w.__click=function(...S){e.onglossary?.apply(this,S)};var k=y(w,2);k.__click=function(...S){e.onchangekey?.apply(this,S)};var p=y(k,2),E=y(v(p));E.__click=function(...S){e.ondedication?.apply(this,S)},he(2),g(p),g(a),I(s,a),pe()}me(["click"]);const is=[{level:"Beginner",tenses:[{name:"Present Simple",description:"Acciones habituales, rutinas o verdades generales.",example:"She works every day.",structure:"Sujeto + verbo (base / +s en 3a persona)",tip:'Usa "do/does" para preguntas y negaciones.'},{name:"Present Continuous",description:"Acciones que ocurren en este momento o situaciones temporales.",example:"They are playing in the park.",structure:"Sujeto + am/is/are + verbo-ing",tip:"No se usa con verbos de estado (know, want, like)."},{name:"Going to (Future)",description:"Planes o intenciones futuras, o predicciones basadas en evidencia.",example:"I am going to travel next month.",structure:"Sujeto + am/is/are + going to + verbo base",tip:"Indica que ya se ha decidido o hay evidencia visible."},{name:"Simple Past",description:"Acciones completadas en el pasado.",example:"We visited the museum yesterday.",structure:"Sujeto + verbo en pasado (-ed / irregular)",tip:'Usa "did" para preguntas y negaciones. Cuidado con los verbos irregulares (goâ†’went, eatâ†’ate).'}]},{level:"Intermediate",tenses:[{name:"Present Perfect",description:"Acciones pasadas con conexion al presente, o experiencias de vida.",example:"I have visited three countries.",structure:"Sujeto + have/has + participio pasado",tip:'Usa "ever", "never", "already", "yet", "just" como pistas.'},{name:"Past Continuous",description:"Acciones en progreso en un momento del pasado, o acciones interrumpidas.",example:"She was reading when the phone rang.",structure:"Sujeto + was/were + verbo-ing",tip:'Frecuentemente se combina con Simple Past usando "when" o "while".'},{name:"Will (Future)",description:"Decisiones espontaneas, predicciones, promesas u ofertas.",example:"I will help you with that.",structure:"Sujeto + will + verbo base",tip:'A diferencia de "going to", indica decision en el momento o prediccion sin evidencia.'},{name:"First Conditional",description:"Situaciones posibles/probables en el futuro.",example:"If it rains, we will stay home.",structure:"If + present simple, will + verbo base",tip:'La condicion es real y posible. No uses "will" en la clausula con "if".'},{name:"Modals (can, must, should)",description:"Expresan habilidad, obligacion o consejo.",example:"You should study more. / She can swim very well.",structure:'Sujeto + modal + verbo base (sin "to")',tip:"Can = poder/saber, must = deber (obligacion fuerte), should = deberia (consejo)."}]},{level:"Advanced",tenses:[{name:"Past Perfect",description:"Una accion que ocurrio antes de otra accion en el pasado.",example:"She had already left when I arrived.",structure:"Sujeto + had + participio pasado",tip:'Es "el pasado del pasado". Usa "already", "just", "never", "before" como pistas.'},{name:"Third Conditional",description:"Situaciones hipoteticas del pasado (que no ocurrieron).",example:"If I had studied, I would have passed.",structure:"If + past perfect, would have + participio",tip:"Expresa arrepentimiento o especulacion sobre el pasado. Es irreal."},{name:"Passive Voice",description:"Cuando el foco esta en la accion o el receptor, no en quien la realiza.",example:"The book was written by a famous author.",structure:"Sujeto (receptor) + be + participio pasado",tip:'Usa "by" para indicar quien realiza la accion (agente), pero es opcional.'},{name:"Passive Voice - Present Simple",description:"Voz pasiva para acciones habituales o verdades generales.",example:"The reports are reviewed every Monday.",structure:"Sujeto + am/is/are + participio pasado",tip:'Usa "am/is/are" como auxiliar. Ej: "English is spoken here."'},{name:"Passive Voice - Present Continuous",description:"Voz pasiva para acciones en progreso ahora mismo.",example:"The house is being painted this week.",structure:"Sujeto + am/is/are + being + participio pasado",tip:'Agrega "being" entre el auxiliar y el participio. Ej: "is being repaired".'},{name:"Passive Voice - Past Simple",description:"Voz pasiva para acciones completadas en el pasado.",example:"The letter was sent yesterday.",structure:"Sujeto + was/were + participio pasado",tip:'Usa "was/were" como auxiliar. Ej: "The cake was made by my grandmother."'},{name:"Passive Voice - Past Continuous",description:"Voz pasiva para acciones en progreso en un momento del pasado.",example:"The road was being repaired when we arrived.",structure:"Sujeto + was/were + being + participio pasado",tip:'Similar al present continuous pasivo pero en pasado: "was/were being + participio".'},{name:"Passive Voice - Present Perfect",description:"Voz pasiva para acciones pasadas con conexion al presente.",example:"The homework has been finished already.",structure:"Sujeto + have/has + been + participio pasado",tip:'Combina "have/has been" + participio. Ej: "has been sold".'},{name:"Passive Voice - Past Perfect",description:"Voz pasiva para acciones que ocurrieron antes de otra accion pasada.",example:"The dinner had been prepared before the guests arrived.",structure:"Sujeto + had + been + participio pasado",tip:'Usa "had been" + participio. Es el pasado del pasado en voz pasiva.'},{name:"Passive Voice - Will (Future)",description:"Voz pasiva para acciones futuras.",example:"The winners will be announced tomorrow.",structure:"Sujeto + will + be + participio pasado",tip:'Usa "will be" + participio. Ej: "will be delivered", "will be invited".'},{name:"Passive Voice - Going to (Future)",description:"Voz pasiva para planes o intenciones futuras.",example:"The park is going to be renovated next year.",structure:"Sujeto + am/is/are + going to + be + participio pasado",tip:'Agrega "be" antes del participio: "is going to be cleaned".'},{name:"Passive Voice - Modal Verb",description:"Voz pasiva combinada con un verbo modal (can, must, should, could, might).",example:"This report must be finished by Friday.",structure:"Sujeto + modal + be + participio pasado",tip:'El modal va primero, luego "be" + participio. Ej: "can be done", "should be reviewed", "must be sent".'},{name:"Reported Speech",description:"Relatar lo que alguien dijo, cambiando tiempos verbales.",example:"He said that he was tired.",structure:"Sujeto + said/told + (that) + oracion con tiempo retrocedido",tip:'Los tiempos "retroceden": presentâ†’past, pastâ†’past perfect, willâ†’would.'},{name:"Subjunctive",description:"Deseos, sugerencias o situaciones hipoteticas.",example:"I wish I were taller. / He suggested that she study harder.",structure:"Wish + past simple / suggest + (that) + verbo base",tip:'Con "wish", usa "were" para todas las personas (no "was").'}]}];function $r(s){const e=s.toLowerCase().trim();for(const i of is)for(const o of i.tenses)if(o.name.toLowerCase()===e)return o;let t=e.replace(/[-â€“,]/g," ");t.includes("passive")&&!t.includes("voice")&&(t=t.replace("passive","passive voice")),t.includes("future")&&!t.includes("will")&&(t+=" will");const n=new Set(t.split(/\s+/).filter(Boolean));let r=null,a=0;for(const i of is)for(const o of i.tenses){const d=o.name.toLowerCase().replace(/\([^)]*\)/g,"").replace(/[-â€“,]/g," ").split(/\s+/).filter(Boolean);d.every(f=>n.has(f))&&d.length>a&&(r=o,a=d.length)}return r}var Fr=Xn('<svg class="info-icon svelte-n845i0" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>'),Vr=N('<span class="tag negative svelte-n845i0">negativo</span>'),Hr=N('<div class="tense-popup svelte-n845i0"><p class="popup-title svelte-n845i0"> </p> <p class="popup-desc svelte-n845i0"> </p> <div class="popup-detail svelte-n845i0"><span class="popup-label svelte-n845i0">Estructura</span> <p class="popup-text svelte-n845i0"> </p></div> <div class="popup-detail example svelte-n845i0"><span class="popup-label svelte-n845i0">Ejemplo</span> <p class="popup-text svelte-n845i0"> </p></div> <div class="popup-detail tip svelte-n845i0"><span class="popup-label svelte-n845i0">Tip</span> <p class="popup-text svelte-n845i0"> </p></div></div>'),Jr=N('<div class="prompt-display svelte-n845i0"><div class="hints"><p class="hint-label svelte-n845i0">Pistas</p> <p class="hint-text svelte-n845i0"> </p></div> <div class="meta svelte-n845i0"><button> <!></button> <!></div> <!></div>');function Xr(s,e){fe(e,!0);let t=U(!1);const n=ae(()=>$r(e.metadata.tense));function r(){u(n)&&T(t,!u(t))}var a=Jr(),i=v(a),o=y(v(i),2),c=v(o,!0);g(o),g(i);var d=y(i,2),f=v(d);let w;f.__click=r;var k=v(f),p=y(k);{var E=M=>{var A=Fr();I(M,A)};G(p,M=>{u(n)&&M(E)})}g(f);var S=y(f,2);{var h=M=>{var A=Vr();I(M,A)};G(S,M=>{e.metadata.isNegative&&M(h)})}g(d);var m=y(d,2);{var b=M=>{var A=Hr(),x=v(A),B=v(x,!0);g(x);var P=y(x,2),L=v(P,!0);g(P);var q=y(P,2),C=y(v(q),2),H=v(C,!0);g(C),g(q);var K=y(q,2),Ee=y(v(K),2),Dt=v(Ee,!0);g(Ee),g(K);var F=y(K,2),ke=y(v(F),2),lt=v(ke,!0);g(ke),g(F),g(A),$(()=>{j(B,u(n).name),j(L,u(n).description),j(H,u(n).structure),j(Dt,u(n).example),j(lt,u(n).tip)}),I(M,A)};G(m,M=>{u(t)&&u(n)&&M(b)})}g(a),$(()=>{j(c,e.hintDisplay),w=et(f,1,"tag tense-tag svelte-n845i0",null,w,{clickable:!!u(n)}),j(k,`${e.metadata.tense??""} `)}),I(s,a),pe()}me(["click"]);var Gr=N("<button> </button>");function an(s,e){let t=kr(e,"variant",3,"pool");var n=Gr();n.__click=function(...a){e.onclick?.apply(this,a)};var r=v(n,!0);g(n),$(()=>{et(n,1,`word-card ${t()??""}`,"svelte-pj5bsu"),j(r,e.text)}),I(s,n)}me(["click"]);var Kr=N('<p class="placeholder svelte-1d0eofs">Toca las palabras para armar la frase...</p>'),Yr=N('<div class="sentence-area svelte-1d0eofs"><p class="label svelte-1d0eofs">Tu frase</p> <div class="sentence-box svelte-1d0eofs"><!> <!></div></div>');function Qr(s,e){fe(e,!0);var t=Yr(),n=y(v(t),2),r=v(n);we(r,17,()=>e.cards,o=>o.id,(o,c)=>{an(o,{get text(){return u(c).text},onclick:()=>e.ondeselect(u(c).id),variant:"sentence"})});var a=y(r,2);{var i=o=>{var c=Kr();I(o,c)};G(a,o=>{e.cards.length===0&&o(i)})}g(n),g(t),I(s,t),pe()}var Zr=N('<p class="empty svelte-ymehbo">Todas las palabras fueron usadas</p>'),ea=N('<div class="card-pool svelte-ymehbo"><p class="label svelte-ymehbo">Palabras disponibles</p> <div class="cards svelte-ymehbo"><!> <!></div></div>');function ta(s,e){fe(e,!0);var t=ea(),n=y(v(t),2),r=v(n);we(r,17,()=>e.cards,o=>o.id,(o,c)=>{an(o,{get text(){return u(c).text},onclick:()=>e.onselect(u(c).id),variant:"pool"})});var a=y(r,2);{var i=o=>{var c=Zr();I(o,c)};G(a,o=>{e.cards.length===0&&o(i)})}g(n),g(t),I(s,t),pe()}var sa=N('<div class="correct-answer svelte-p7nz7"><p class="correct-label svelte-p7nz7">Respuesta correcta:</p> <p class="correct-text svelte-p7nz7"> </p></div>'),na=N('<div><div class="result-icon svelte-p7nz7"> </div> <p class="result-label svelte-p7nz7"> </p> <p class="feedback svelte-p7nz7"> </p> <!> <div class="grammar-note svelte-p7nz7"><p class="note-label svelte-p7nz7">Nota gramatical</p> <p class="note-text svelte-p7nz7"> </p></div> <button class="next-btn svelte-p7nz7">Siguiente</button></div>');function ra(s,e){fe(e,!0);var t=na(),n=v(t),r=v(n,!0);g(n);var a=y(n,2),i=v(a,!0);g(a);var o=y(a,2),c=v(o,!0);g(o);var d=y(o,2);{var f=S=>{var h=sa(),m=y(v(h),2),b=v(m,!0);g(m),g(h),$(()=>j(b,e.result.correctSentence)),I(S,h)};G(d,S=>{e.result.isCorrect||S(f)})}var w=y(d,2),k=y(v(w),2),p=v(k,!0);g(k),g(w);var E=y(w,2);E.__click=function(...S){e.onnext?.apply(this,S)},g(t),$(()=>{et(t,1,`feedback-panel ${e.result.isCorrect?"correct":"incorrect"}`,"svelte-p7nz7"),j(r,e.result.isCorrect?"âœ“":"âœ—"),j(i,e.result.isCorrect?"Â¡Correcto!":"Incorrecto"),j(c,e.result.feedback),j(p,e.result.grammarNote)}),I(s,t),pe()}me(["click"]);var aa=N('<div class="score-bar svelte-1szkqx"><button class="back-btn svelte-1szkqx" aria-label="Volver al inicio"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button> <div class="stat svelte-1szkqx"><span class="stat-value svelte-1szkqx"> </span> <span class="stat-label svelte-1szkqx">Ronda</span></div> <div class="stat svelte-1szkqx"><span class="stat-value svelte-1szkqx"> </span> <span class="stat-label svelte-1szkqx">Aciertos</span></div> <div class="stat svelte-1szkqx"><span class="stat-value svelte-1szkqx"> </span> <span class="stat-label svelte-1szkqx">Racha</span></div> <div class="stat svelte-1szkqx"><span class="stat-value svelte-1szkqx"> </span> <span class="stat-label svelte-1szkqx">Mejor</span></div></div>');function ia(s,e){fe(e,!0);var t=aa(),n=v(t);n.__click=function(...h){e.onback?.apply(this,h)};var r=y(n,2),a=v(r),i=v(a,!0);g(a),he(2),g(r);var o=y(r,2),c=v(o),d=v(c);g(c),he(2),g(o);var f=y(o,2),w=v(f),k=v(w,!0);g(w),he(2),g(f);var p=y(f,2),E=v(p),S=v(E,!0);g(E),he(2),g(p),g(t),$(()=>{j(i,e.session.currentRound),j(d,`${e.session.totalCorrect??""}/${e.session.totalAttempted??""}`),j(k,e.session.streak),j(S,e.session.bestStreak)}),I(s,t),pe()}me(["click"]);let ms=U(""),on=U("beginner"),cn=U("random"),ln=U(void 0),gs=U("setup"),Se=U(null),se=U(ps([])),st=U(null),nt=U(null),Ct=U(ps([])),Z=U(ps({currentRound:0,totalCorrect:0,totalAttempted:0,streak:0,bestStreak:0}));function Cs(){return u(ms)}function oa(){return u(on)}function ca(){return u(cn)}function la(){return u(ln)}function un(){return u(gs)}function ua(){return u(Se)}function da(){return u(st)}function ha(){return u(nt)}function fa(){return u(Ct)}function pa(){return u(Z)}function ma(s){T(ms,s,!0),localStorage.setItem("grammar_game_api_key",s)}function ga(){const s=localStorage.getItem("grammar_game_api_key");return s&&T(ms,s,!0),!!s}function va(s){T(on,s,!0)}function ba(s){T(cn,s,!0)}function _a(s){T(ln,s,!0)}function ie(s){T(gs,s,!0)}function dn(s){T(Se,s,!0),T(se,[],!0),T(st,null),T(nt,null),T(Ct,[...u(Ct).slice(-9),s.correctSentence],!0)}function ya(s){T(st,s,!0),u(Z).totalAttempted++,s.isCorrect?(u(Z).totalCorrect++,u(Z).streak++,u(Z).streak>u(Z).bestStreak&&(u(Z).bestStreak=u(Z).streak)):u(Z).streak=0}function Mt(s){T(nt,s,!0)}function wa(s){u(se).includes(s)||T(se,[...u(se),s],!0)}function Sa(s){T(se,u(se).filter(e=>e!==s),!0)}function ka(){T(se,[],!0)}function xa(){return u(Se)?u(Se).cards.filter(s=>!u(se).includes(s.id)):[]}function hn(){return u(Se)?u(se).map(s=>u(Se).cards.find(e=>e.id===s)).filter(s=>s!==void 0):[]}function Ta(){return hn().map(s=>s.text).join(" ")}function fn(){u(Z).currentRound++,T(Se,null),T(se,[],!0),T(st,null),T(nt,null)}function Ra(){T(gs,"setup"),T(Se,null),T(se,[],!0),T(st,null),T(nt,null),T(Ct,[],!0),T(Z,{currentRound:0,totalCorrect:0,totalAttempted:0,streak:0,bestStreak:0},!0)}function _(s,e,t,n,r){if(typeof e=="function"?s!==e||!0:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(s,t),t}function l(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)}let pn=function(){const{crypto:s}=globalThis;if(s?.randomUUID)return pn=s.randomUUID.bind(s),s.randomUUID();const e=new Uint8Array(1),t=s?()=>s.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))};function tt(s){return typeof s=="object"&&s!==null&&("name"in s&&s.name==="AbortError"||"message"in s&&String(s.message).includes("FetchRequestCanceledException"))}const os=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null){try{if(Object.prototype.toString.call(s)==="[object Error]"){const e=new Error(s.message,s.cause?{cause:s.cause}:{});return s.stack&&(e.stack=s.stack),s.cause&&!e.cause&&(e.cause=s.cause),s.name&&(e.name=s.name),e}}catch{}try{return new Error(JSON.stringify(s))}catch{}}return new Error(s)};class R extends Error{}class z extends R{constructor(e,t,n,r){super(`${z.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.requestID=r?.get("request-id"),this.error=t}static makeMessage(e,t,n){const r=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new Ot({message:n,cause:os(t)});const a=t;return e===400?new gn(e,a,n,r):e===401?new vn(e,a,n,r):e===403?new bn(e,a,n,r):e===404?new _n(e,a,n,r):e===409?new yn(e,a,n,r):e===422?new wn(e,a,n,r):e===429?new Sn(e,a,n,r):e>=500?new kn(e,a,n,r):new z(e,a,n,r)}}class te extends z{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Ot extends z{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class mn extends Ot{constructor({message:e}={}){super({message:e??"Request timed out."})}}class gn extends z{}class vn extends z{}class bn extends z{}class _n extends z{}class yn extends z{}class wn extends z{}class Sn extends z{}class kn extends z{}const Ea=/^[a-z][a-z0-9+.-]*:/i,Ma=s=>Ea.test(s);let cs=s=>(cs=Array.isArray,cs(s)),Is=cs;function js(s){return typeof s!="object"?{}:s??{}}function Pa(s){if(!s)return!0;for(const e in s)return!1;return!0}function Aa(s,e){return Object.prototype.hasOwnProperty.call(s,e)}const Ca=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new R(`${s} must be an integer`);if(e<0)throw new R(`${s} must be a positive integer`);return e},xn=s=>{try{return JSON.parse(s)}catch{return}},Ia=s=>new Promise(e=>setTimeout(e,s)),Ie="0.65.0",ja=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Na(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const Oa=()=>{const s=Na();if(s==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ie,"X-Stainless-OS":Os(Deno.build.os),"X-Stainless-Arch":Ns(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ie,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(s==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ie,"X-Stainless-OS":Os(globalThis.process.platform??"unknown"),"X-Stainless-Arch":Ns(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=qa();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ie,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ie,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function qa(){if(typeof navigator>"u"||!navigator)return null;const s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of s){const n=t.exec(navigator.userAgent);if(n){const r=n[1]||0,a=n[2]||0,i=n[3]||0;return{browser:e,version:`${r}.${a}.${i}`}}}return null}const Ns=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",Os=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown");let qs;const Ba=()=>qs??(qs=Oa());function La(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Tn(...s){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...s)}function Rn(s){let e=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s[Symbol.iterator]();return Tn({start(){},async pull(t){const{done:n,value:r}=await e.next();n?t.close():t.enqueue(r)},async cancel(){await e.return?.()}})}function vs(s){if(s[Symbol.asyncIterator])return s;const e=s.getReader();return{async next(){try{const t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Da(s){if(s===null||typeof s!="object")return;if(s[Symbol.asyncIterator]){await s[Symbol.asyncIterator]().return?.();return}const e=s.getReader(),t=e.cancel();e.releaseLock(),await t}const Ua=({headers:s,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});function za(s){let e=0;for(const r of s)e+=r.length;const t=new Uint8Array(e);let n=0;for(const r of s)t.set(r,n),n+=r.length;return t}let Bs;function bs(s){let e;return(Bs??(e=new globalThis.TextEncoder,Bs=e.encode.bind(e)))(s)}let Ls;function Ds(s){let e;return(Ls??(e=new globalThis.TextDecoder,Ls=e.decode.bind(e)))(s)}var J,X;class rt{constructor(){J.set(this,void 0),X.set(this,void 0),_(this,J,new Uint8Array),_(this,X,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?bs(e):e;_(this,J,za([l(this,J,"f"),t]));const n=[];let r;for(;(r=Wa(l(this,J,"f"),l(this,X,"f")))!=null;){if(r.carriage&&l(this,X,"f")==null){_(this,X,r.index);continue}if(l(this,X,"f")!=null&&(r.index!==l(this,X,"f")+1||r.carriage)){n.push(Ds(l(this,J,"f").subarray(0,l(this,X,"f")-1))),_(this,J,l(this,J,"f").subarray(l(this,X,"f"))),_(this,X,null);continue}const a=l(this,X,"f")!==null?r.preceding-1:r.preceding,i=Ds(l(this,J,"f").subarray(0,a));n.push(i),_(this,J,l(this,J,"f").subarray(r.index)),_(this,X,null)}return n}flush(){return l(this,J,"f").length?this.decode(`
`):[]}}J=new WeakMap,X=new WeakMap;rt.NEWLINE_CHARS=new Set([`
`,"\r"]);rt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Wa(s,e){for(let r=e??0;r<s.length;r++){if(s[r]===10)return{preceding:r,index:r+1,carriage:!1};if(s[r]===13)return{preceding:r,index:r+1,carriage:!0}}return null}function $a(s){for(let n=0;n<s.length-1;n++){if(s[n]===10&&s[n+1]===10||s[n]===13&&s[n+1]===13)return n+2;if(s[n]===13&&s[n+1]===10&&n+3<s.length&&s[n+2]===13&&s[n+3]===10)return n+4}return-1}const It={off:0,error:200,warn:300,info:400,debug:500},Us=(s,e,t)=>{if(s){if(Aa(It,s))return s;W(t).warn(`${e} was set to ${JSON.stringify(s)}, expected one of ${JSON.stringify(Object.keys(It))}`)}};function Qe(){}function dt(s,e,t){return!e||It[s]>It[t]?Qe:e[s].bind(e)}const Fa={error:Qe,warn:Qe,info:Qe,debug:Qe};let zs=new WeakMap;function W(s){const e=s.logger,t=s.logLevel??"off";if(!e)return Fa;const n=zs.get(e);if(n&&n[0]===t)return n[1];const r={error:dt("error",e,t),warn:dt("warn",e,t),info:dt("info",e,t),debug:dt("debug",e,t)};return zs.set(e,[t,r]),r}const Re=s=>(s.options&&(s.options={...s.options},delete s.options.headers),s.headers&&(s.headers=Object.fromEntries((s.headers instanceof Headers?[...s.headers]:Object.entries(s.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in s&&(s.retryOfRequestLogID&&(s.retryOf=s.retryOfRequestLogID),delete s.retryOfRequestLogID),s);var Be;class oe{constructor(e,t,n){this.iterator=e,Be.set(this,void 0),this.controller=t,_(this,Be,n)}static fromSSEResponse(e,t,n){let r=!1;const a=n?W(n):console;async function*i(){if(r)throw new R("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(const c of Va(e,t)){if(c.event==="completion")try{yield JSON.parse(c.data)}catch(d){throw a.error("Could not parse message into JSON:",c.data),a.error("From chunk:",c.raw),d}if(c.event==="message_start"||c.event==="message_delta"||c.event==="message_stop"||c.event==="content_block_start"||c.event==="content_block_delta"||c.event==="content_block_stop")try{yield JSON.parse(c.data)}catch(d){throw a.error("Could not parse message into JSON:",c.data),a.error("From chunk:",c.raw),d}if(c.event!=="ping"&&c.event==="error")throw new z(void 0,xn(c.data)??c.data,void 0,e.headers)}o=!0}catch(c){if(tt(c))return;throw c}finally{o||t.abort()}}return new oe(i,t,n)}static fromReadableStream(e,t,n){let r=!1;async function*a(){const o=new rt,c=vs(e);for await(const d of c)for(const f of o.decode(d))yield f;for(const d of o.flush())yield d}async function*i(){if(r)throw new R("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(const c of a())o||c&&(yield JSON.parse(c));o=!0}catch(c){if(tt(c))return;throw c}finally{o||t.abort()}}return new oe(i,t,n)}[(Be=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=a=>({next:()=>{if(a.length===0){const i=n.next();e.push(i),t.push(i)}return a.shift()}});return[new oe(()=>r(e),this.controller,l(this,Be,"f")),new oe(()=>r(t),this.controller,l(this,Be,"f"))]}toReadableStream(){const e=this;let t;return Tn({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{const{value:r,done:a}=await t.next();if(a)return n.close();const i=bs(JSON.stringify(r)+`
`);n.enqueue(i)}catch(r){n.error(r)}},async cancel(){await t.return?.()}})}}async function*Va(s,e){if(!s.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new R("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new R("Attempted to iterate over a response with no body");const t=new Ja,n=new rt,r=vs(s.body);for await(const a of Ha(r))for(const i of n.decode(a)){const o=t.decode(i);o&&(yield o)}for(const a of n.flush()){const i=t.decode(a);i&&(yield i)}}async function*Ha(s){let e=new Uint8Array;for await(const t of s){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?bs(t):t;let r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),e=r;let a;for(;(a=$a(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class Ja{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=Xa(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}}function Xa(s,e){const t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}async function En(s,e){const{response:t,requestLogID:n,retryOfRequestLogID:r,startTime:a}=e,i=await(async()=>{if(e.options.stream)return W(s).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):oe.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const c=t.headers.get("content-type")?.split(";")[0]?.trim();if(c?.includes("application/json")||c?.endsWith("+json")){const w=await t.json();return Mn(w,t)}return await t.text()})();return W(s).debug(`[${n}] response parsed`,Re({retryOfRequestLogID:r,url:t.url,status:t.status,body:i,durationMs:Date.now()-a})),i}function Mn(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}var Ze;class qt extends Promise{constructor(e,t,n=En){super(r=>{r(null)}),this.responsePromise=t,this.parseResponse=n,Ze.set(this,void 0),_(this,Ze,e)}_thenUnwrap(e){return new qt(l(this,Ze,"f"),this.responsePromise,async(t,n)=>Mn(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(l(this,Ze,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}Ze=new WeakMap;var ht;class Ga{constructor(e,t,n,r){ht.set(this,void 0),_(this,ht,e),this.options=r,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new R("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await l(this,ht,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(ht=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Ka extends qt{constructor(e,t,n){super(e,t,async(r,a)=>new n(r,a.response,await En(r,a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}class at extends Ga{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1,this.first_id=n.first_id||null,this.last_id=n.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){const t=this.first_id;return t?{...this.options,query:{...js(this.options.query),before_id:t}}:null}const e=this.last_id;return e?{...this.options,query:{...js(this.options.query),after_id:e}}:null}}const Pn=()=>{if(typeof File>"u"){const{process:s}=globalThis,e=typeof s?.versions?.node=="string"&&parseInt(s.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Oe(s,e,t){return Pn(),new File(s,e??"unknown_file",t)}function Pt(s){return(typeof s=="object"&&s!==null&&("name"in s&&s.name&&String(s.name)||"url"in s&&s.url&&String(s.url)||"filename"in s&&s.filename&&String(s.filename)||"path"in s&&s.path&&String(s.path))||"").split(/[\\/]/).pop()||void 0}const An=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",Ya=async(s,e)=>({...s,body:await Za(s.body,e)}),Ws=new WeakMap;function Qa(s){const e=typeof s=="function"?s:s.fetch,t=Ws.get(e);if(t)return t;const n=(async()=>{try{const r="Response"in e?e.Response:(await e("data:,")).constructor,a=new FormData;return a.toString()!==await new r(a).text()}catch{return!0}})();return Ws.set(e,n),n}const Za=async(s,e)=>{if(!await Qa(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(s||{}).map(([n,r])=>ls(t,n,r))),t},ei=s=>s instanceof Blob&&"name"in s,ls=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(t instanceof Response){let n={};const r=t.headers.get("Content-Type");r&&(n={type:r}),s.append(e,Oe([await t.blob()],Pt(t),n))}else if(An(t))s.append(e,Oe([await new Response(Rn(t)).blob()],Pt(t)));else if(ei(t))s.append(e,Oe([t],Pt(t),{type:t.type}));else if(Array.isArray(t))await Promise.all(t.map(n=>ls(s,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,r])=>ls(s,`${e}[${n}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},Cn=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",ti=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&Cn(s),si=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function";async function ni(s,e,t){if(Pn(),s=await s,e||(e=Pt(s)),ti(s))return s instanceof File&&e==null&&t==null?s:Oe([await s.arrayBuffer()],e??s.name,{type:s.type,lastModified:s.lastModified,...t});if(si(s)){const r=await s.blob();return e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()),Oe(await us(r),e,t)}const n=await us(s);if(!t?.type){const r=n.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof r=="string"&&(t={...t,type:r})}return Oe(n,e,t)}async function us(s){let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(Cn(s))e.push(s instanceof Blob?s:await s.arrayBuffer());else if(An(s))for await(const t of s)e.push(...await us(t));else{const t=s?.constructor?.name;throw new Error(`Unexpected data type: ${typeof s}${t?`; constructor: ${t}`:""}${ri(s)}`)}return e}function ri(s){return typeof s!="object"||s===null?"":`; props: [${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}class ge{constructor(e){this._client=e}}const In=Symbol.for("brand.privateNullableHeaders");function*ai(s){if(!s)return;if(In in s){const{values:n,nulls:r}=s;yield*n.entries();for(const a of r)yield[a,null];return}let e=!1,t;s instanceof Headers?t=s.entries():Is(s)?t=s:(e=!0,t=Object.entries(s??{}));for(let n of t){const r=n[0];if(typeof r!="string")throw new TypeError("expected header name to be a string");const a=Is(n[1])?n[1]:[n[1]];let i=!1;for(const o of a)o!==void 0&&(e&&!i&&(i=!0,yield[r,null]),yield[r,o])}}const O=s=>{const e=new Headers,t=new Set;for(const n of s){const r=new Set;for(const[a,i]of ai(n)){const o=a.toLowerCase();r.has(o)||(e.delete(a),r.add(o)),i===null?(e.delete(a),t.add(o)):(e.append(a,i),t.delete(o))}}return{[In]:!0,values:e,nulls:t}};function jn(s){return s.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const $s=Object.freeze(Object.create(null)),ii=(s=jn)=>function(t,...n){if(t.length===1)return t[0];let r=!1;const a=[],i=t.reduce((f,w,k)=>{/[?#]/.test(w)&&(r=!0);const p=n[k];let E=(r?encodeURIComponent:s)(""+p);return k!==n.length&&(p==null||typeof p=="object"&&p.toString===Object.getPrototypeOf(Object.getPrototypeOf(p.hasOwnProperty??$s)??$s)?.toString)&&(E=p+"",a.push({start:f.length+w.length,length:E.length,error:`Value of type ${Object.prototype.toString.call(p).slice(8,-1)} is not a valid path parameter`})),f+w+(k===n.length?"":E)},""),o=i.split(/[?#]/,1)[0],c=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let d;for(;(d=c.exec(o))!==null;)a.push({start:d.index,length:d[0].length,error:`Value "${d[0]}" can't be safely passed as a path parameter`});if(a.sort((f,w)=>f.start-w.start),a.length>0){let f=0;const w=a.reduce((k,p)=>{const E=" ".repeat(p.start-f),S="^".repeat(p.length);return f=p.start+p.length,k+E+S},"");throw new R(`Path parameters result in path with invalid segments:
${a.map(k=>k.error).join(`
`)}
${i}
${w}`)}return i},ne=ii(jn);class Nn extends ge{list(e={},t){const{betas:n,...r}=e??{};return this._client.getAPIList("/v1/files",at,{query:r,...t,headers:O([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString()},t?.headers])})}delete(e,t={},n){const{betas:r}=t??{};return this._client.delete(ne`/v1/files/${e}`,{...n,headers:O([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},n?.headers])})}download(e,t={},n){const{betas:r}=t??{};return this._client.get(ne`/v1/files/${e}/content`,{...n,headers:O([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},n){const{betas:r}=t??{};return this._client.get(ne`/v1/files/${e}`,{...n,headers:O([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},n?.headers])})}upload(e,t){const{betas:n,...r}=e;return this._client.post("/v1/files",Ya({body:r,...t,headers:O([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString()},t?.headers])},this._client))}}let On=class extends ge{retrieve(e,t={},n){const{betas:r}=t??{};return this._client.get(ne`/v1/models/${e}?beta=true`,{...n,headers:O([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},n?.headers])})}list(e={},t){const{betas:n,...r}=e??{};return this._client.getAPIList("/v1/models?beta=true",at,{query:r,...t,headers:O([{...n?.toString()!=null?{"anthropic-beta":n?.toString()}:void 0},t?.headers])})}};class Bt{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new rt;for await(const t of this.iterator)for(const n of e.decode(t))yield JSON.parse(n);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new R("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new R("Attempted to iterate over a response with no body");return new Bt(vs(e.body),t)}}let qn=class extends ge{create(e,t){const{betas:n,...r}=e;return this._client.post("/v1/messages/batches?beta=true",{body:r,...t,headers:O([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},t?.headers])})}retrieve(e,t={},n){const{betas:r}=t??{};return this._client.get(ne`/v1/messages/batches/${e}?beta=true`,{...n,headers:O([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},n?.headers])})}list(e={},t){const{betas:n,...r}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",at,{query:r,...t,headers:O([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},t?.headers])})}delete(e,t={},n){const{betas:r}=t??{};return this._client.delete(ne`/v1/messages/batches/${e}?beta=true`,{...n,headers:O([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},n?.headers])})}cancel(e,t={},n){const{betas:r}=t??{};return this._client.post(ne`/v1/messages/batches/${e}/cancel?beta=true`,{...n,headers:O([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},n?.headers])})}async results(e,t={},n){const r=await this.retrieve(e);if(!r.results_url)throw new R(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);const{betas:a}=t??{};return this._client.get(r.results_url,{...n,headers:O([{"anthropic-beta":[...a??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},n?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((i,o)=>Bt.fromResponse(o.response,o.controller))}};const oi=s=>{let e=0,t=[];for(;e<s.length;){let n=s[e];if(n==="\\"){e++;continue}if(n==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(n==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(n==="["){t.push({type:"paren",value:"["}),e++;continue}if(n==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(n===":"){t.push({type:"separator",value:":"}),e++;continue}if(n===","){t.push({type:"delimiter",value:","}),e++;continue}if(n==='"'){let o="",c=!1;for(n=s[++e];n!=='"';){if(e===s.length){c=!0;break}if(n==="\\"){if(e++,e===s.length){c=!0;break}o+=n+s[e],n=s[++e]}else o+=n,n=s[++e]}n=s[++e],c||t.push({type:"string",value:o});continue}if(n&&/\s/.test(n)){e++;continue}let a=/[0-9]/;if(n&&a.test(n)||n==="-"||n==="."){let o="";for(n==="-"&&(o+=n,n=s[++e]);n&&a.test(n)||n===".";)o+=n,n=s[++e];t.push({type:"number",value:o});continue}let i=/[a-z]/i;if(n&&i.test(n)){let o="";for(;n&&i.test(n)&&e!==s.length;)o+=n,n=s[++e];if(o=="true"||o=="false"||o==="null")t.push({type:"name",value:o});else{e++;continue}continue}e++}return t},je=s=>{if(s.length===0)return s;let e=s[s.length-1];switch(e.type){case"separator":return s=s.slice(0,s.length-1),je(s);case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return s=s.slice(0,s.length-1),je(s);case"string":let n=s[s.length-2];if(n?.type==="delimiter")return s=s.slice(0,s.length-1),je(s);if(n?.type==="brace"&&n.value==="{")return s=s.slice(0,s.length-1),je(s);break;case"delimiter":return s=s.slice(0,s.length-1),je(s)}return s},ci=s=>{let e=[];return s.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?s.push({type:"brace",value:"}"}):t==="]"&&s.push({type:"paren",value:"]"})}),s},li=s=>{let e="";return s.map(t=>{t.type==="string"?e+='"'+t.value+'"':e+=t.value}),e},Bn=s=>JSON.parse(li(ci(je(oi(s)))));var Y,be,Le,ft,De,Ue,pt,ze,ce,We,mt,gt,Me,vt,bt,Jt,Fs,_t,Xt,Gt,Kt,Vs;const Hs="__json_buf";function Js(s){return s.type==="tool_use"||s.type==="server_tool_use"||s.type==="mcp_tool_use"}class jt{constructor(){Y.add(this),this.messages=[],this.receivedMessages=[],be.set(this,void 0),this.controller=new AbortController,Le.set(this,void 0),ft.set(this,()=>{}),De.set(this,()=>{}),Ue.set(this,void 0),pt.set(this,()=>{}),ze.set(this,()=>{}),ce.set(this,{}),We.set(this,!1),mt.set(this,!1),gt.set(this,!1),Me.set(this,!1),vt.set(this,void 0),bt.set(this,void 0),_t.set(this,e=>{if(_(this,mt,!0),tt(e)&&(e=new te),e instanceof te)return _(this,gt,!0),this._emit("abort",e);if(e instanceof R)return this._emit("error",e);if(e instanceof Error){const t=new R(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new R(String(e)))}),_(this,Le,new Promise((e,t)=>{_(this,ft,e,"f"),_(this,De,t,"f")})),_(this,Ue,new Promise((e,t)=>{_(this,pt,e,"f"),_(this,ze,t,"f")})),l(this,Le,"f").catch(()=>{}),l(this,Ue,"f").catch(()=>{})}get response(){return l(this,vt,"f")}get request_id(){return l(this,bt,"f")}async withResponse(){const e=await l(this,Le,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new jt;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,n){const r=new jt;for(const a of t.messages)r._addMessageParam(a);return r._run(()=>r._createMessage(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},l(this,_t,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,n){const r=n?.signal;let a;r&&(r.aborted&&this.controller.abort(),a=this.controller.abort.bind(this.controller),r.addEventListener("abort",a));try{l(this,Y,"m",Xt).call(this);const{response:i,data:o}=await e.create({...t,stream:!0},{...n,signal:this.controller.signal}).withResponse();this._connected(i);for await(const c of o)l(this,Y,"m",Gt).call(this,c);if(o.controller.signal?.aborted)throw new te;l(this,Y,"m",Kt).call(this)}finally{r&&a&&r.removeEventListener("abort",a)}}_connected(e){this.ended||(_(this,vt,e),_(this,bt,e?.headers.get("request-id")),l(this,ft,"f").call(this,e),this._emit("connect"))}get ended(){return l(this,We,"f")}get errored(){return l(this,mt,"f")}get aborted(){return l(this,gt,"f")}abort(){this.controller.abort()}on(e,t){return(l(this,ce,"f")[e]||(l(this,ce,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=l(this,ce,"f")[e];if(!n)return this;const r=n.findIndex(a=>a.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(l(this,ce,"f")[e]||(l(this,ce,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{_(this,Me,!0),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){_(this,Me,!0),await l(this,Ue,"f")}get currentMessage(){return l(this,be,"f")}async finalMessage(){return await this.done(),l(this,Y,"m",Jt).call(this)}async finalText(){return await this.done(),l(this,Y,"m",Fs).call(this)}_emit(e,...t){if(l(this,We,"f"))return;e==="end"&&(_(this,We,!0),l(this,pt,"f").call(this));const n=l(this,ce,"f")[e];if(n&&(l(this,ce,"f")[e]=n.filter(r=>!r.once),n.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!l(this,Me,"f")&&!n?.length&&Promise.reject(r),l(this,De,"f").call(this,r),l(this,ze,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!l(this,Me,"f")&&!n?.length&&Promise.reject(r),l(this,De,"f").call(this,r),l(this,ze,"f").call(this,r),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",l(this,Y,"m",Jt).call(this))}async _fromReadableStream(e,t){const n=t?.signal;let r;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{l(this,Y,"m",Xt).call(this),this._connected(null);const a=oe.fromReadableStream(e,this.controller);for await(const i of a)l(this,Y,"m",Gt).call(this,i);if(a.controller.signal?.aborted)throw new te;l(this,Y,"m",Kt).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}[(be=new WeakMap,Le=new WeakMap,ft=new WeakMap,De=new WeakMap,Ue=new WeakMap,pt=new WeakMap,ze=new WeakMap,ce=new WeakMap,We=new WeakMap,mt=new WeakMap,gt=new WeakMap,Me=new WeakMap,vt=new WeakMap,bt=new WeakMap,_t=new WeakMap,Y=new WeakSet,Jt=function(){if(this.receivedMessages.length===0)throw new R("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Fs=function(){if(this.receivedMessages.length===0)throw new R("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(n=>n.type==="text").map(n=>n.text);if(t.length===0)throw new R("stream ended without producing a content block with type=text");return t.join(" ")},Xt=function(){this.ended||_(this,be,void 0)},Gt=function(t){if(this.ended)return;const n=l(this,Y,"m",Vs).call(this,t);switch(this._emit("streamEvent",t,n),t.type){case"content_block_delta":{const r=n.content.at(-1);switch(t.delta.type){case"text_delta":{r.type==="text"&&this._emit("text",t.delta.text,r.text||"");break}case"citations_delta":{r.type==="text"&&this._emit("citation",t.delta.citation,r.citations??[]);break}case"input_json_delta":{Js(r)&&r.input&&this._emit("inputJson",t.delta.partial_json,r.input);break}case"thinking_delta":{r.type==="thinking"&&this._emit("thinking",t.delta.thinking,r.thinking);break}case"signature_delta":{r.type==="thinking"&&this._emit("signature",r.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(n),this._addMessage(n,!0);break}case"content_block_stop":{this._emit("contentBlock",n.content.at(-1));break}case"message_start":{_(this,be,n);break}}},Kt=function(){if(this.ended)throw new R("stream has ended, this shouldn't happen");const t=l(this,be,"f");if(!t)throw new R("request ended without sending any chunks");return _(this,be,void 0),t},Vs=function(t){let n=l(this,be,"f");if(t.type==="message_start"){if(n)throw new R(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!n)throw new R(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return n;case"message_delta":return n.container=t.delta.container,n.stop_reason=t.delta.stop_reason,n.stop_sequence=t.delta.stop_sequence,n.usage.output_tokens=t.usage.output_tokens,n.context_management=t.context_management,t.usage.input_tokens!=null&&(n.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(n.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(n.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(n.usage.server_tool_use=t.usage.server_tool_use),n;case"content_block_start":return n.content.push(t.content_block),n;case"content_block_delta":{const r=n.content.at(t.index);switch(t.delta.type){case"text_delta":{r?.type==="text"&&(n.content[t.index]={...r,text:(r.text||"")+t.delta.text});break}case"citations_delta":{r?.type==="text"&&(n.content[t.index]={...r,citations:[...r.citations??[],t.delta.citation]});break}case"input_json_delta":{if(r&&Js(r)){let a=r[Hs]||"";a+=t.delta.partial_json;const i={...r};if(Object.defineProperty(i,Hs,{value:a,enumerable:!1,writable:!0}),a)try{i.input=Bn(a)}catch(o){const c=new R(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${o}. JSON: ${a}`);l(this,_t,"f").call(this,c)}n.content[t.index]=i}break}case"thinking_delta":{r?.type==="thinking"&&(n.content[t.index]={...r,thinking:r.thinking+t.delta.thinking});break}case"signature_delta":{r?.type==="thinking"&&(n.content[t.index]={...r,signature:t.delta.signature});break}default:t.delta}return n}case"content_block_stop":return n}},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("streamEvent",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new oe(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}const Ln={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192,"claude-opus-4-1-20250805":8192,"anthropic.claude-opus-4-1-20250805-v1:0":8192,"claude-opus-4-1@20250805":8192};var yt,Pe,xe,V,$e,re,ue,_e,Fe,ds;function Xs(){let s,e;return{promise:new Promise((n,r)=>{s=n,e=r}),resolve:s,reject:e}}class Dn{constructor(e,t,n){yt.add(this),this.client=e,Pe.set(this,!1),xe.set(this,!1),V.set(this,void 0),$e.set(this,void 0),re.set(this,void 0),ue.set(this,void 0),_e.set(this,void 0),Fe.set(this,0),_(this,V,{params:{...t,messages:structuredClone(t.messages)}}),_(this,$e,{...n,headers:O([{"x-stainless-helper":"BetaToolRunner"},n?.headers])}),_(this,_e,Xs())}async*[(Pe=new WeakMap,xe=new WeakMap,V=new WeakMap,$e=new WeakMap,re=new WeakMap,ue=new WeakMap,_e=new WeakMap,Fe=new WeakMap,yt=new WeakSet,Symbol.asyncIterator)](){var e;if(l(this,Pe,"f"))throw new R("Cannot iterate over a consumed stream");_(this,Pe,!0),_(this,xe,!0),_(this,ue,void 0);try{for(;;){let t;try{if(l(this,V,"f").params.max_iterations&&l(this,Fe,"f")>=l(this,V,"f").params.max_iterations)break;_(this,xe,!1,"f"),_(this,re,void 0,"f"),_(this,ue,void 0,"f"),_(this,Fe,(e=l(this,Fe,"f"),e++,e),"f");const{max_iterations:n,...r}=l(this,V,"f").params;if(r.stream?(t=this.client.beta.messages.stream({...r},l(this,$e,"f")),_(this,re,t.finalMessage(),"f"),yield t):(_(this,re,this.client.beta.messages.create({...r,stream:!1},l(this,$e,"f")),"f"),yield l(this,re,"f")),!l(this,xe,"f")){const{role:i,content:o}=await l(this,re,"f");l(this,V,"f").params.messages.push({role:i,content:o})}const a=await l(this,yt,"m",ds).call(this,l(this,V,"f").params.messages.at(-1));if(a&&l(this,V,"f").params.messages.push(a),!a&&!l(this,xe,"f"))break}finally{t&&t.abort()}}if(!l(this,re,"f"))throw new R("ToolRunner concluded without a message from the server");l(this,_e,"f").resolve(await l(this,re,"f"))}catch(t){throw _(this,Pe,!1),l(this,_e,"f").promise.catch(()=>{}),l(this,_e,"f").reject(t),_(this,_e,Xs()),t}}setMessagesParams(e){typeof e=="function"?l(this,V,"f").params=e(l(this,V,"f").params):l(this,V,"f").params=e,_(this,xe,!0),_(this,ue,void 0)}async generateToolResponse(){const e=await l(this,re,"f")??this.params.messages.at(-1);return e?l(this,yt,"m",ds).call(this,e):null}done(){return l(this,_e,"f").promise}async runUntilDone(){if(!l(this,Pe,"f"))for await(const e of this);return this.done()}get params(){return l(this,V,"f").params}pushMessages(...e){this.setMessagesParams(t=>({...t,messages:[...t.messages,...e]}))}then(e,t){return this.runUntilDone().then(e,t)}}ds=async function(e){return l(this,ue,"f")!==void 0?l(this,ue,"f"):(_(this,ue,ui(l(this,V,"f").params,e)),l(this,ue,"f"))};async function ui(s,e=s.messages.at(-1)){if(!e||e.role!=="assistant"||!e.content||typeof e.content=="string")return null;const t=e.content.filter(r=>r.type==="tool_use");return t.length===0?null:{role:"user",content:await Promise.all(t.map(async r=>{const a=s.tools.find(i=>i.name===r.name);if(!a||!("run"in a))return{type:"tool_result",tool_use_id:r.id,content:`Error: Tool '${r.name}' not found`,is_error:!0};try{let i=r.input;"parse"in a&&a.parse&&(i=a.parse(i));const o=await a.run(i);return{type:"tool_result",tool_use_id:r.id,content:o}}catch(i){return{type:"tool_result",tool_use_id:r.id,content:`Error: ${i instanceof Error?i.message:String(i)}`,is_error:!0}}}))}}const Gs={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-5-sonnet-20241022":"October 22, 2025","claude-3-5-sonnet-20240620":"October 22, 2025"};let Lt=class extends ge{constructor(){super(...arguments),this.batches=new qn(this._client)}create(e,t){const{betas:n,...r}=e;r.model in Gs&&console.warn(`The model '${r.model}' is deprecated and will reach end-of-life on ${Gs[r.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let a=this._client._options.timeout;if(!r.stream&&a==null){const i=Ln[r.model]??void 0;a=this._client.calculateNonstreamingTimeout(r.max_tokens,i)}return this._client.post("/v1/messages?beta=true",{body:r,timeout:a??6e5,...t,headers:O([{...n?.toString()!=null?{"anthropic-beta":n?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}stream(e,t){return jt.createMessage(this,e,t)}countTokens(e,t){const{betas:n,...r}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:r,...t,headers:O([{"anthropic-beta":[...n??[],"token-counting-2024-11-01"].toString()},t?.headers])})}toolRunner(e,t){return new Dn(this._client,e,t)}};Lt.Batches=qn;Lt.BetaToolRunner=Dn;class it extends ge{constructor(){super(...arguments),this.models=new On(this._client),this.messages=new Lt(this._client),this.files=new Nn(this._client)}}it.Models=On;it.Messages=Lt;it.Files=Nn;class Un extends ge{create(e,t){const{betas:n,...r}=e;return this._client.post("/v1/complete",{body:r,timeout:this._client._options.timeout??6e5,...t,headers:O([{...n?.toString()!=null?{"anthropic-beta":n?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}}var Q,ye,Ve,wt,He,Je,St,Xe,le,Ge,kt,xt,Ae,Tt,Rt,Yt,Ks,Qt,Zt,es,ts,Ys;const Qs="__json_buf";function Zs(s){return s.type==="tool_use"||s.type==="server_tool_use"}class Nt{constructor(){Q.add(this),this.messages=[],this.receivedMessages=[],ye.set(this,void 0),this.controller=new AbortController,Ve.set(this,void 0),wt.set(this,()=>{}),He.set(this,()=>{}),Je.set(this,void 0),St.set(this,()=>{}),Xe.set(this,()=>{}),le.set(this,{}),Ge.set(this,!1),kt.set(this,!1),xt.set(this,!1),Ae.set(this,!1),Tt.set(this,void 0),Rt.set(this,void 0),Qt.set(this,e=>{if(_(this,kt,!0),tt(e)&&(e=new te),e instanceof te)return _(this,xt,!0),this._emit("abort",e);if(e instanceof R)return this._emit("error",e);if(e instanceof Error){const t=new R(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new R(String(e)))}),_(this,Ve,new Promise((e,t)=>{_(this,wt,e,"f"),_(this,He,t,"f")})),_(this,Je,new Promise((e,t)=>{_(this,St,e,"f"),_(this,Xe,t,"f")})),l(this,Ve,"f").catch(()=>{}),l(this,Je,"f").catch(()=>{})}get response(){return l(this,Tt,"f")}get request_id(){return l(this,Rt,"f")}async withResponse(){const e=await l(this,Ve,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new Nt;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,n){const r=new Nt;for(const a of t.messages)r._addMessageParam(a);return r._run(()=>r._createMessage(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},l(this,Qt,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,n){const r=n?.signal;let a;r&&(r.aborted&&this.controller.abort(),a=this.controller.abort.bind(this.controller),r.addEventListener("abort",a));try{l(this,Q,"m",Zt).call(this);const{response:i,data:o}=await e.create({...t,stream:!0},{...n,signal:this.controller.signal}).withResponse();this._connected(i);for await(const c of o)l(this,Q,"m",es).call(this,c);if(o.controller.signal?.aborted)throw new te;l(this,Q,"m",ts).call(this)}finally{r&&a&&r.removeEventListener("abort",a)}}_connected(e){this.ended||(_(this,Tt,e),_(this,Rt,e?.headers.get("request-id")),l(this,wt,"f").call(this,e),this._emit("connect"))}get ended(){return l(this,Ge,"f")}get errored(){return l(this,kt,"f")}get aborted(){return l(this,xt,"f")}abort(){this.controller.abort()}on(e,t){return(l(this,le,"f")[e]||(l(this,le,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=l(this,le,"f")[e];if(!n)return this;const r=n.findIndex(a=>a.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(l(this,le,"f")[e]||(l(this,le,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{_(this,Ae,!0),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){_(this,Ae,!0),await l(this,Je,"f")}get currentMessage(){return l(this,ye,"f")}async finalMessage(){return await this.done(),l(this,Q,"m",Yt).call(this)}async finalText(){return await this.done(),l(this,Q,"m",Ks).call(this)}_emit(e,...t){if(l(this,Ge,"f"))return;e==="end"&&(_(this,Ge,!0),l(this,St,"f").call(this));const n=l(this,le,"f")[e];if(n&&(l(this,le,"f")[e]=n.filter(r=>!r.once),n.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!l(this,Ae,"f")&&!n?.length&&Promise.reject(r),l(this,He,"f").call(this,r),l(this,Xe,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!l(this,Ae,"f")&&!n?.length&&Promise.reject(r),l(this,He,"f").call(this,r),l(this,Xe,"f").call(this,r),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",l(this,Q,"m",Yt).call(this))}async _fromReadableStream(e,t){const n=t?.signal;let r;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{l(this,Q,"m",Zt).call(this),this._connected(null);const a=oe.fromReadableStream(e,this.controller);for await(const i of a)l(this,Q,"m",es).call(this,i);if(a.controller.signal?.aborted)throw new te;l(this,Q,"m",ts).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}[(ye=new WeakMap,Ve=new WeakMap,wt=new WeakMap,He=new WeakMap,Je=new WeakMap,St=new WeakMap,Xe=new WeakMap,le=new WeakMap,Ge=new WeakMap,kt=new WeakMap,xt=new WeakMap,Ae=new WeakMap,Tt=new WeakMap,Rt=new WeakMap,Qt=new WeakMap,Q=new WeakSet,Yt=function(){if(this.receivedMessages.length===0)throw new R("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Ks=function(){if(this.receivedMessages.length===0)throw new R("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(n=>n.type==="text").map(n=>n.text);if(t.length===0)throw new R("stream ended without producing a content block with type=text");return t.join(" ")},Zt=function(){this.ended||_(this,ye,void 0)},es=function(t){if(this.ended)return;const n=l(this,Q,"m",Ys).call(this,t);switch(this._emit("streamEvent",t,n),t.type){case"content_block_delta":{const r=n.content.at(-1);switch(t.delta.type){case"text_delta":{r.type==="text"&&this._emit("text",t.delta.text,r.text||"");break}case"citations_delta":{r.type==="text"&&this._emit("citation",t.delta.citation,r.citations??[]);break}case"input_json_delta":{Zs(r)&&r.input&&this._emit("inputJson",t.delta.partial_json,r.input);break}case"thinking_delta":{r.type==="thinking"&&this._emit("thinking",t.delta.thinking,r.thinking);break}case"signature_delta":{r.type==="thinking"&&this._emit("signature",r.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(n),this._addMessage(n,!0);break}case"content_block_stop":{this._emit("contentBlock",n.content.at(-1));break}case"message_start":{_(this,ye,n);break}}},ts=function(){if(this.ended)throw new R("stream has ended, this shouldn't happen");const t=l(this,ye,"f");if(!t)throw new R("request ended without sending any chunks");return _(this,ye,void 0),t},Ys=function(t){let n=l(this,ye,"f");if(t.type==="message_start"){if(n)throw new R(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!n)throw new R(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return n;case"message_delta":return n.stop_reason=t.delta.stop_reason,n.stop_sequence=t.delta.stop_sequence,n.usage.output_tokens=t.usage.output_tokens,t.usage.input_tokens!=null&&(n.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(n.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(n.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(n.usage.server_tool_use=t.usage.server_tool_use),n;case"content_block_start":return n.content.push({...t.content_block}),n;case"content_block_delta":{const r=n.content.at(t.index);switch(t.delta.type){case"text_delta":{r?.type==="text"&&(n.content[t.index]={...r,text:(r.text||"")+t.delta.text});break}case"citations_delta":{r?.type==="text"&&(n.content[t.index]={...r,citations:[...r.citations??[],t.delta.citation]});break}case"input_json_delta":{if(r&&Zs(r)){let a=r[Qs]||"";a+=t.delta.partial_json;const i={...r};Object.defineProperty(i,Qs,{value:a,enumerable:!1,writable:!0}),a&&(i.input=Bn(a)),n.content[t.index]=i}break}case"thinking_delta":{r?.type==="thinking"&&(n.content[t.index]={...r,thinking:r.thinking+t.delta.thinking});break}case"signature_delta":{r?.type==="thinking"&&(n.content[t.index]={...r,signature:t.delta.signature});break}default:t.delta}return n}case"content_block_stop":return n}},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("streamEvent",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new oe(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class zn extends ge{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(ne`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",at,{query:e,...t})}delete(e,t){return this._client.delete(ne`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(ne`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const n=await this.retrieve(e);if(!n.results_url)throw new R(`No batch \`results_url\`; Has it finished processing? ${n.processing_status} - ${n.id}`);return this._client.get(n.results_url,{...t,headers:O([{Accept:"application/binary"},t?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((r,a)=>Bt.fromResponse(a.response,a.controller))}}class _s extends ge{constructor(){super(...arguments),this.batches=new zn(this._client)}create(e,t){e.model in en&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${en[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let n=this._client._options.timeout;if(!e.stream&&n==null){const r=Ln[e.model]??void 0;n=this._client.calculateNonstreamingTimeout(e.max_tokens,r)}return this._client.post("/v1/messages",{body:e,timeout:n??6e5,...t,stream:e.stream??!1})}stream(e,t){return Nt.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}const en={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-5-sonnet-20241022":"October 22, 2025","claude-3-5-sonnet-20240620":"October 22, 2025"};_s.Batches=zn;class Wn extends ge{retrieve(e,t={},n){const{betas:r}=t??{};return this._client.get(ne`/v1/models/${e}`,{...n,headers:O([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},n?.headers])})}list(e={},t){const{betas:n,...r}=e??{};return this._client.getAPIList("/v1/models",at,{query:r,...t,headers:O([{...n?.toString()!=null?{"anthropic-beta":n?.toString()}:void 0},t?.headers])})}}var di={};const Et=s=>{if(typeof globalThis.process<"u")return di?.[s]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(s)?.trim()};var hs,ys,At,$n;const hi="\\n\\nHuman:",fi="\\n\\nAssistant:";class D{constructor({baseURL:e=Et("ANTHROPIC_BASE_URL"),apiKey:t=Et("ANTHROPIC_API_KEY")??null,authToken:n=Et("ANTHROPIC_AUTH_TOKEN")??null,...r}={}){hs.add(this),At.set(this,void 0);const a={apiKey:t,authToken:n,...r,baseURL:e||"https://api.anthropic.com"};if(!a.dangerouslyAllowBrowser&&ja())throw new R(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);this.baseURL=a.baseURL,this.timeout=a.timeout??ys.DEFAULT_TIMEOUT,this.logger=a.logger??console;const i="warn";this.logLevel=i,this.logLevel=Us(a.logLevel,"ClientOptions.logLevel",this)??Us(Et("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??i,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??La(),_(this,At,Ua),this._options=a,this.apiKey=t,this.authToken=n}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(this.apiKey&&e.get("x-api-key"))&&!t.has("x-api-key")&&!(this.authToken&&e.get("authorization"))&&!t.has("authorization"))throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}async authHeaders(e){return O([await this.apiKeyAuth(e),await this.bearerAuth(e)])}async apiKeyAuth(e){if(this.apiKey!=null)return O([{"X-Api-Key":this.apiKey}])}async bearerAuth(e){if(this.authToken!=null)return O([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new R(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Ie}`}defaultIdempotencyKey(){return`stainless-node-retry-${pn()}`}makeStatusError(e,t,n,r){return z.generate(e,t,n,r)}buildURL(e,t,n){const r=!l(this,hs,"m",$n).call(this)&&n||this.baseURL,a=Ma(e)?new URL(e):new URL(r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return Pa(i)||(t={...i,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(a.search=this.stringifyQuery(t)),a.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new R("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 600*1e3}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(r=>({method:e,path:t,...r})))}request(e,t=null){return new qt(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){const r=await e,a=r.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(r);const{req:i,url:o,timeout:c}=await this.buildRequest(r,{retryCount:a-t});await this.prepareRequest(i,{url:o,options:r});const d="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),f=n===void 0?"":`, retryOf: ${n}`,w=Date.now();if(W(this).debug(`[${d}] sending request`,Re({retryOfRequestLogID:n,method:r.method,url:o,options:r,headers:i.headers})),r.signal?.aborted)throw new te;const k=new AbortController,p=await this.fetchWithTimeout(o,i,c,k).catch(os),E=Date.now();if(p instanceof globalThis.Error){const m=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new te;const b=tt(p)||/timed? ?out/i.test(String(p)+("cause"in p?String(p.cause):""));if(t)return W(this).info(`[${d}] connection ${b?"timed out":"failed"} - ${m}`),W(this).debug(`[${d}] connection ${b?"timed out":"failed"} (${m})`,Re({retryOfRequestLogID:n,url:o,durationMs:E-w,message:p.message})),this.retryRequest(r,t,n??d);throw W(this).info(`[${d}] connection ${b?"timed out":"failed"} - error; no more retries left`),W(this).debug(`[${d}] connection ${b?"timed out":"failed"} (error; no more retries left)`,Re({retryOfRequestLogID:n,url:o,durationMs:E-w,message:p.message})),b?new mn:new Ot({cause:p})}const S=[...p.headers.entries()].filter(([m])=>m==="request-id").map(([m,b])=>", "+m+": "+JSON.stringify(b)).join(""),h=`[${d}${f}${S}] ${i.method} ${o} ${p.ok?"succeeded":"failed"} with status ${p.status} in ${E-w}ms`;if(!p.ok){const m=await this.shouldRetry(p);if(t&&m){const P=`retrying, ${t} attempts remaining`;return await Da(p.body),W(this).info(`${h} - ${P}`),W(this).debug(`[${d}] response error (${P})`,Re({retryOfRequestLogID:n,url:p.url,status:p.status,headers:p.headers,durationMs:E-w})),this.retryRequest(r,t,n??d,p.headers)}const b=m?"error; no more retries left":"error; not retryable";W(this).info(`${h} - ${b}`);const M=await p.text().catch(P=>os(P).message),A=xn(M),x=A?void 0:M;throw W(this).debug(`[${d}] response error (${b})`,Re({retryOfRequestLogID:n,url:p.url,status:p.status,headers:p.headers,message:x,durationMs:Date.now()-w})),this.makeStatusError(p.status,A,x,p.headers)}return W(this).info(h),W(this).debug(`[${d}] response start`,Re({retryOfRequestLogID:n,url:p.url,status:p.status,headers:p.headers,durationMs:E-w})),{response:p,options:r,controller:k,requestLogID:d,retryOfRequestLogID:n,startTime:w}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){const n=this.makeRequest(t,null,void 0);return new Ka(this,n,e)}async fetchWithTimeout(e,t,n,r){const{signal:a,method:i,...o}=t||{};a&&a.addEventListener("abort",()=>r.abort());const c=setTimeout(()=>r.abort(),n),d=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,f={signal:r.signal,...d?{duplex:"half"}:{},method:"GET",...o};i&&(f.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,f)}finally{clearTimeout(c)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,r){let a;const i=r?.get("retry-after-ms");if(i){const c=parseFloat(i);Number.isNaN(c)||(a=c)}const o=r?.get("retry-after");if(o&&!a){const c=parseFloat(o);Number.isNaN(c)?a=Date.parse(o)-Date.now():a=c*1e3}if(!(a&&0<=a&&a<60*1e3)){const c=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,c)}return await Ia(a),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||t!=null&&e>t)throw new R("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}async buildRequest(e,{retryCount:t=0}={}){const n={...e},{method:r,path:a,query:i,defaultBaseURL:o}=n,c=this.buildURL(a,i,o);"timeout"in n&&Ca("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const{bodyHeaders:d,body:f}=this.buildBody({options:n}),w=await this.buildHeaders({options:e,method:r,bodyHeaders:d,retryCount:t});return{req:{method:r,headers:w,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&f instanceof globalThis.ReadableStream&&{duplex:"half"},...f&&{body:f},...this.fetchOptions??{},...n.fetchOptions??{}},url:c,timeout:n.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:r}){let a={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const i=O([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...Ba(),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=O([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:Rn(e)}:l(this,At,"f").call(this,{body:e,headers:n})}}ys=D,At=new WeakMap,hs=new WeakSet,$n=function(){return this.baseURL!=="https://api.anthropic.com"};D.Anthropic=ys;D.HUMAN_PROMPT=hi;D.AI_PROMPT=fi;D.DEFAULT_TIMEOUT=6e5;D.AnthropicError=R;D.APIError=z;D.APIConnectionError=Ot;D.APIConnectionTimeoutError=mn;D.APIUserAbortError=te;D.NotFoundError=_n;D.ConflictError=yn;D.RateLimitError=Sn;D.BadRequestError=gn;D.AuthenticationError=vn;D.InternalServerError=kn;D.PermissionDeniedError=bn;D.UnprocessableEntityError=wn;D.toFile=ni;class ot extends D{constructor(){super(...arguments),this.completions=new Un(this),this.messages=new _s(this),this.models=new Wn(this),this.beta=new it(this)}}ot.Completions=Un;ot.Messages=_s;ot.Models=Wn;ot.Beta=it;const pi={beginner:{tenses:"present simple, present continuous, going to (future), simple past",wordRange:"4-7 words",distractors:"2-3 distractors"},intermediate:{tenses:"present perfect, past continuous, will future, first conditional, modals (can, must, should)",wordRange:"5-9 words",distractors:"3-4 distractors"},advanced:{tenses:"past perfect, third conditional, passive voice, reported speech, subjunctive",wordRange:"6-12 words",distractors:"4-6 distractors"}};function ss(s){return s[Math.floor(Math.random()*s.length)]}const mi=["I","you","he","she","we","they","my friend","the students","my parents","the dog","our teacher","the children"],gi={"dev meetings & scrum":["the team","the developer","the scrum master","the product owner","we","the QA engineer","the tech lead","the intern","the backend team","the designer"],"software engineering":["the developer","the architect","we","the API","the server","the database","the frontend","the microservice","the application","the system","the engineer","the DevOps team"]},vi={"dev meetings & scrum":"Use vocabulary related to agile/scrum and dev team workflows. Examples include standup, sprint, backlog, blocker, retrospective, code review, deploy, pull request, ticket, demo, velocity, release, branch, merge â€” but feel free to use any other related vocabulary.","software engineering":"Use vocabulary related to software development and infrastructure. Examples include API, database, server, cloud, Docker, cache, endpoint, query, schema, microservice, pipeline, authentication, deployment â€” but feel free to use any other related vocabulary."};function bi(s,e="random",t,n=[]){const r=pi[s],a=r.tenses.split(", "),i=t||ss(a),o=e==="random"?ss(qr):e,c=gi[o]||mi,d=ss(c),f=vi[o]||"",w=Math.floor(Math.random()*1e5),k=n.length>0?`
DO NOT generate any of these sentences (or similar ones):
${n.map(p=>`- "${p}"`).join(`
`)}
You MUST create a completely different sentence with a different subject, verb, and complement.
`:"";return`You are a grammar exercise generator for English learners. Generate ONE exercise.

DIFFICULTY: ${s}
TENSE TO USE: ${i}
TOPIC: ${o}${f?`
TOPIC VOCABULARY: ${f}`:""}
SENTENCE LENGTH: ${r.wordRange}
DISTRACTORS: ${r.distractors}
SUGGESTED SUBJECT: ${d} (use this or a similar subject)
SEED: ${w}
${k}

INSTRUCTIONS:
1. Use the specified tense and topic above. Be creative and generate a unique sentence.
2. FIRST write the correct English sentence (correctSentence). This is the source of truth for the entire exercise.
3. THEN create conceptual hints ENTIRELY IN SPANISH that describe ONLY what is in the correctSentence:
   - Sujeto: describe the subject in Spanish (e.g., "ella", "mis padres", "un perro")
   - Verbo: the verb in Spanish infinitive (e.g., "cocinar", "ir", "estudiar")
     MODAL VERBS RULE: When the sentence uses a modal verb, DO NOT just say "poder". Be specific:
     - can â†’ "poder (habilidad)"
     - could â†’ "podrÃ­a (posibilidad/pasado)"
     - should â†’ "deberÃ­a (consejo)"
     - must â†’ "deber (obligaciÃ³n)"
     - might â†’ "podrÃ­a/quizÃ¡s (posibilidad)"
     - may â†’ "poder (permiso/posibilidad)"
     Always include the main verb too, e.g., "deberÃ­a (consejo) + enviar", "poder (habilidad) + nadar"
   - Complemento: describe the complement in Spanish (e.g., "en el parque", "una carta", "con sus amigos")
   - Tiempo: time expression in Spanish (e.g., "ayer", "todos los dÃ­as", "ahora mismo")
   NEVER use English words in the hints â€” EXCEPT for technical jargon that developers use in Spanish without translating (e.g., "pull request", "sprint", "deploy", "bug", "backlog", "standup", "branch", "merge", "pipeline", "scrum master"). These terms should stay in English in the hints because that's how Spanish speakers actually use them.
4. Break the correctSentence into individual word cards (one card per word).
5. Add ${r.distractors} that are plausible wrong choices.

CRITICAL CONSISTENCY RULE:
- The hints MUST describe EXACTLY the correctSentence â€” nothing more, nothing less.
- Every concept mentioned in the hints MUST have corresponding words in correctSentence.
- Example of WRONG: hints say "Complemento: en el gimnasio" but correctSentence is "My sister is going to exercise" (missing "at the gym").
- Example of CORRECT: hints say "Complemento: en el gimnasio" and correctSentence is "My sister is going to exercise at the gym".
- There must be exactly one card per word in correctSentence with isDistractor: false.

OTHER RULES:
- Each card has exactly ONE word (never two words in one card)
- No punctuation in card text (no periods, commas, etc.)
- NO duplicate words across cards. If a distractor would duplicate an existing card, pick a different distractor.
- The first word of the correct sentence should be capitalized
- Distractors should be tricky but fair (e.g., "goed" instead of "went", "in" instead of "at")
- Vary between affirmative and negative sentences

Respond ONLY with valid JSON in this exact format, no markdown:
{
  "hints": ["Sujeto: ...", "Verbo: ...", "Complemento: ...", "Tiempo: ..."],
  "hintDisplay": "Sujeto: ... / Verbo: ... / Complemento: ... / Tiempo: ...",
  "correctSentence": "The full correct sentence",
  "cards": [
    {"id": "d1", "text": "distractor", "isDistractor": true},
    {"id": "c3", "text": "word3", "isDistractor": false},
    {"id": "c1", "text": "word1", "isDistractor": false},
    {"id": "c2", "text": "word2", "isDistractor": false}
  ],
  "metadata": {
    "tense": "present simple",
    "isNegative": false,
    "difficulty": "${s}",
    "topic": "daily routine"
  }
}

Use unique IDs like c1, c2... for correct words and d1, d2... for distractors. Remember: cards MUST be shuffled, not in sentence order.`}function _i(s,e,t,n){return`You are an English grammar evaluator for Spanish-speaking learners.

CONTEXT:
- Grammar: ${e.tense}, ${e.isNegative?"negative":"affirmative"}
- Topic: ${e.topic}
- Difficulty: ${e.difficulty}
- Expected answer: "${t}"
- Student's answer: "${n}"

INSTRUCTIONS:
1. Compare the student's answer ONLY with the expected answer. The expected answer is the ONLY correct reference â€” do not use the hints to judge correctness.
2. The answer is CORRECT if it conveys the same meaning with valid grammar, even if word order differs slightly or uses valid synonyms (e.g., "do not" vs "don't").
3. If incorrect, explain WHY in Spanish in a friendly, educational way.
4. Always include a brief grammar note in Spanish explaining the rule used.
5. The "correctSentence" field in your response MUST be exactly: "${t}" â€” do not modify it.

Respond ONLY with valid JSON in this exact format, no markdown:
{
  "isCorrect": true,
  "feedback": "Brief feedback message in Spanish",
  "correctSentence": "${t}",
  "grammarNote": "Grammar explanation in Spanish about the tense/structure used"
}`}function Fn(s){return new ot({apiKey:s,dangerouslyAllowBrowser:!0})}function Vn(s){const e=s.match(/```(?:json)?\s*([\s\S]*?)```/);return e?e[1].trim():s.trim()}function yi(s){return s.replace(/[.,!?;:]+$/g,"").trim().split(/\s+/).map(e=>e.replace(/[.,!?;:]+$/,"").trim()).filter(Boolean)}function wi(s,e){const t=e.replace(/[.,!?;:]+/g,"").split(/\s+/).filter(Boolean),n=t.map((c,d)=>({id:`c${d+1}`,text:c,isDistractor:!1})),r=new Set(t.map(c=>c.toLowerCase())),a=[],i=new Set;let o=1;for(const c of s){if(!c.isDistractor)continue;const d=yi(c.text);for(const f of d){const w=f.toLowerCase();i.has(w)||r.has(w)||(i.add(w),a.push({id:`d${o++}`,text:f,isDistractor:!0}))}}return[...n,...a]}function Si(s){const e=[...s];for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}async function Hn(s,e,t="random",n,r=[]){const a=Fn(s),i=bi(e,t,n,r),c=(await a.messages.create({model:"claude-haiku-4-5-20251001",max_tokens:1024,messages:[{role:"user",content:i}]})).content[0];if(c.type!=="text")throw new Error("Unexpected response type");const d=JSON.parse(Vn(c.text));return d.cards=wi(d.cards,d.correctSentence),d.cards=Si(d.cards),d}async function ki(s,e,t,n,r){const a=Fn(s),i=_i(e,t,n,r),c=(await a.messages.create({model:"claude-haiku-4-5-20251001",max_tokens:512,messages:[{role:"user",content:i}]})).content[0];if(c.type!=="text")throw new Error("Unexpected response type");return JSON.parse(Vn(c.text))}let Te=null;function ct(){return Te||(Te=new AudioContext),Te.state==="suspended"&&Te.resume(),Te}function Ke(s,e,t="sine",n=.15){const r=ct(),a=r.createOscillator(),i=r.createGain();a.type=t,a.frequency.value=s,i.gain.setValueAtTime(n,r.currentTime),i.gain.exponentialRampToValueAtTime(.001,r.currentTime+e),a.connect(i),i.connect(r.destination),a.start(r.currentTime),a.stop(r.currentTime+e)}function xi(){const s=ct(),e=s.createOscillator(),t=s.createGain();e.type="sine",e.frequency.setValueAtTime(600,s.currentTime),e.frequency.exponentialRampToValueAtTime(900,s.currentTime+.06),t.gain.setValueAtTime(.12,s.currentTime),t.gain.exponentialRampToValueAtTime(.001,s.currentTime+.1),e.connect(t),t.connect(s.destination),e.start(s.currentTime),e.stop(s.currentTime+.1)}function Ti(){const s=ct(),e=s.createOscillator(),t=s.createGain();e.type="sine",e.frequency.setValueAtTime(800,s.currentTime),e.frequency.exponentialRampToValueAtTime(500,s.currentTime+.08),t.gain.setValueAtTime(.1,s.currentTime),t.gain.exponentialRampToValueAtTime(.001,s.currentTime+.1),e.connect(t),t.connect(s.destination),e.start(s.currentTime),e.stop(s.currentTime+.1)}function Ri(){ct().currentTime,Ke(523,.15,"sine",.15),setTimeout(()=>Ke(659,.15,"sine",.15),100),setTimeout(()=>Ke(784,.15,"sine",.15),200),setTimeout(()=>Ke(1047,.3,"sine",.18),300),setTimeout(()=>Ke(1319,.4,"triangle",.08),400)}function Ei(){const s=ct(),e=s.createOscillator(),t=s.createGain();e.type="sawtooth",e.frequency.setValueAtTime(350,s.currentTime),e.frequency.linearRampToValueAtTime(300,s.currentTime+.2),e.frequency.linearRampToValueAtTime(250,s.currentTime+.5),e.frequency.linearRampToValueAtTime(180,s.currentTime+.8),t.gain.setValueAtTime(.1,s.currentTime),t.gain.setValueAtTime(.1,s.currentTime+.15),t.gain.linearRampToValueAtTime(.03,s.currentTime+.25),t.gain.linearRampToValueAtTime(.1,s.currentTime+.35),t.gain.linearRampToValueAtTime(.03,s.currentTime+.5),t.gain.linearRampToValueAtTime(.08,s.currentTime+.6),t.gain.exponentialRampToValueAtTime(.001,s.currentTime+.9),e.connect(t),t.connect(s.destination),e.start(s.currentTime),e.stop(s.currentTime+.9)}var Mi=N('<!> <div class="actions svelte-9e286u"><button class="clear-btn svelte-9e286u">Limpiar</button> <button class="submit-btn svelte-9e286u">Verificar</button></div>',1),Pi=N('<div class="loading-eval svelte-9e286u"><p>Evaluando tu respuesta...</p></div>'),Ai=N("<!> <!> <!> <!> <!>",1),Ci=N('<div class="error-msg svelte-9e286u"><p class="svelte-9e286u"> </p> <div class="error-actions svelte-9e286u"><button class="svelte-9e286u">Cerrar</button> <button class="change-key-btn svelte-9e286u">Cambiar API key</button></div></div>'),Ii=N('<div class="game-board svelte-9e286u"><!> <!> <!></div>');function ji(s,e){fe(e,!0);const t=ae(ua),n=ae(pa),r=ae(un),a=ae(da),i=ae(ha),o=ae(xa),c=ae(hn),d=ae(Ta);let f=U(!1);function w(x){xi(),wa(x)}function k(x){Ti(),Sa(x)}async function p(){if(!(!u(t)||!u(d).trim())){T(f,!0),ie("submitted");try{const x=await ki(Cs(),u(t).hints,u(t).metadata,u(t).correctSentence,u(d));ya(x),x.isCorrect?Ri():Ei(),ie("feedback")}catch(x){Mt(x instanceof Error?x.message:"Error al evaluar"),ie("playing")}finally{T(f,!1)}}}async function E(){fn(),ie("loading");try{const x=await Hn(Cs(),oa(),ca(),la(),fa());dn(x),ie("playing")}catch(x){Mt(x instanceof Error?x.message:"Error al generar"),ie("playing")}}var S=Ii(),h=v(S);ia(h,{get session(){return u(n)},get onback(){return Ra}});var m=y(h,2);{var b=x=>{var B=Ai(),P=rs(B);Xr(P,{get hintDisplay(){return u(t).hintDisplay},get metadata(){return u(t).metadata}});var L=y(P,2);Qr(L,{get cards(){return u(c)},ondeselect:k});var q=y(L,2);{var C=F=>{var ke=Mi(),lt=rs(ke);ta(lt,{get cards(){return u(o)},onselect:w});var ws=y(lt,2),Ut=v(ws);Ut.__click=function(...Jn){ka?.apply(this,Jn)};var Ss=y(Ut,2);Ss.__click=p,g(ws),$(()=>{Ut.disabled=u(c).length===0,Ss.disabled=u(c).length===0}),I(F,ke)};G(q,F=>{u(r)==="playing"&&F(C)})}var H=y(q,2);{var K=F=>{var ke=Pi();I(F,ke)};G(H,F=>{u(r)==="submitted"&&F(K)})}var Ee=y(H,2);{var Dt=F=>{ra(F,{get result(){return u(a)},onnext:E})};G(Ee,F=>{u(r)==="feedback"&&u(a)&&F(Dt)})}I(x,B)};G(m,x=>{u(t)&&x(b)})}var M=y(m,2);{var A=x=>{var B=Ci(),P=v(B),L=v(P,!0);g(P);var q=y(P,2),C=v(q);C.__click=()=>Mt(null);var H=y(C,2);H.__click=()=>{localStorage.removeItem("grammar_game_api_key"),location.reload()},g(q),g(B),$(()=>j(L,u(i))),I(x,B)};G(M,x=>{u(i)&&x(A)})}g(S),I(s,S),pe()}me(["click"]);var Ni=N('<details class="tense-card svelte-14kz89h"><summary class="tense-name svelte-14kz89h"> </summary> <div class="tense-content svelte-14kz89h"><p class="tense-desc svelte-14kz89h"> </p> <div class="tense-detail svelte-14kz89h"><span class="detail-label svelte-14kz89h">Estructura</span> <p class="detail-text svelte-14kz89h"> </p></div> <div class="tense-detail example svelte-14kz89h"><span class="detail-label svelte-14kz89h">Ejemplo</span> <p class="detail-text svelte-14kz89h"> </p></div> <div class="tense-detail tip svelte-14kz89h"><span class="detail-label svelte-14kz89h">Tip</span> <p class="detail-text svelte-14kz89h"> </p></div></div></details>'),Oi=N('<div class="section svelte-14kz89h"><h3 class="section-title svelte-14kz89h"> </h3> <!></div>'),qi=N('<div class="glossary svelte-14kz89h"><div class="glossary-header svelte-14kz89h"><button class="close-btn svelte-14kz89h" aria-label="Cerrar glosario"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button> <h2 class="glossary-title svelte-14kz89h">Glosario gramatical</h2></div> <!></div>');function Bi(s,e){const t={Beginner:"#2d6a4f",Intermediate:"#e85d04",Advanced:"#d00000"};var n=qi(),r=v(n),a=v(r);a.__click=function(...o){e.onclose?.apply(this,o)},he(2),g(r);var i=y(r,2);we(i,17,()=>is,Ne,(o,c)=>{var d=Oi(),f=v(d),w=v(f,!0);g(f);var k=y(f,2);we(k,17,()=>u(c).tenses,Ne,(p,E)=>{var S=Ni(),h=v(S),m=v(h,!0);g(h);var b=y(h,2),M=v(b),A=v(M,!0);g(M);var x=y(M,2),B=y(v(x),2),P=v(B,!0);g(B),g(x);var L=y(x,2),q=y(v(L),2),C=v(q,!0);g(q),g(L);var H=y(L,2),K=y(v(H),2),Ee=v(K,!0);g(K),g(H),g(b),g(S),$(()=>{j(m,u(E).name),j(A,u(E).description),j(P,u(E).structure),j(C,u(E).example),j(Ee,u(E).tip)}),I(p,S)}),g(d),$(()=>{Ar(f,`color: ${t[u(c).level]??""}`),j(w,u(c).level)}),I(o,d)}),g(n),I(s,n)}me(["click"]);var Li=N(`<div class="dedication svelte-kt5d72"><button class="back-btn svelte-kt5d72"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-kt5d72"><path d="M19 12H5" class="svelte-kt5d72"></path><path d="M12 19l-7-7 7-7" class="svelte-kt5d72"></path></svg></button> <div class="heart-big svelte-kt5d72">ðŸ§¡</div> <h2 class="title svelte-kt5d72">Dedicatoria</h2> <div class="message svelte-kt5d72"><p class="svelte-kt5d72">Dedicado a mis hijos <strong class="svelte-kt5d72">Anaelle</strong> y <strong class="svelte-kt5d72">David</strong>,
			a mis padres <strong class="svelte-kt5d72">Reinaldo</strong> y <strong class="svelte-kt5d72">Nelcy</strong>,
			a mi hermanita <strong class="svelte-kt5d72">Jeje</strong>,
			a toda mi familia <strong class="svelte-kt5d72">Dominguez</strong> y <strong class="svelte-kt5d72">Castiblanco</strong>,
			y por ultimo pero no menos importante,
			a mi bella esposa <strong class="svelte-kt5d72">Olga Lucia</strong>.</p> <p class="svelte-kt5d72">Que este jueguito sea una entretencion sana,
			les ayude a dominar el idioma
			y les mantenga la mente saludable y en forma.</p></div> <div class="decoration svelte-kt5d72"><span class="svelte-kt5d72">~</span> <span class="svelte-kt5d72">ðŸ§¡</span> <span class="svelte-kt5d72">~</span></div> <p class="signature svelte-kt5d72">Con todo mi amor, Diego</p></div>`);function Di(s,e){var t=Li(),n=v(t);n.__click=function(...r){e.onclose?.apply(this,r)},he(10),g(t),I(s,t)}me(["click"]);var Ui=N('<div class="loading-screen svelte-1uha8ag"><div class="spinner svelte-1uha8ag"></div> <p>Generando ejercicio...</p></div>');function Ki(s,e){fe(e,!0);const t=ae(un);let n=U(!1),r=U(!1),a=U(!1);Kn(()=>{ga()&&T(n,!0)});function i(b){ma(b),T(n,!0)}async function o(b,M,A){va(b),ba(M),_a(A),fn(),ie("loading");try{const x=await Hn(d(),b,M,A);dn(x),ie("playing")}catch(x){Mt(x instanceof Error?x.message:"Error al generar el ejercicio"),ie("playing")}}function c(){localStorage.removeItem("grammar_game_api_key"),T(n,!1),ie("setup")}function d(){return localStorage.getItem("grammar_game_api_key")??""}var f=Gn(),w=rs(f);{var k=b=>{Nr(b,{onsave:i})},p=b=>{Bi(b,{onclose:()=>T(r,!1)})},E=b=>{Di(b,{onclose:()=>T(a,!1)})},S=b=>{Wr(b,{onselect:o,onglossary:()=>T(r,!0),ondedication:()=>T(a,!0),onchangekey:c})},h=b=>{var M=Ui();I(b,M)},m=b=>{ji(b,{})};G(w,b=>{u(t)==="setup"&&!u(n)?b(k):u(t)==="setup"&&u(n)&&u(r)?b(p,1):u(t)==="setup"&&u(n)&&u(a)?b(E,2):u(t)==="setup"&&u(n)?b(S,3):u(t)==="loading"?b(h,4):b(m,!1)})}I(s,f),pe()}export{Ki as component};
